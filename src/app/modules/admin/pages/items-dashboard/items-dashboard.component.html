<div class="container">
  <app-helper-headerv2
    [mode]="headerConfiguration.mode"
    [fixed]="headerConfiguration.fixed"
    [mainText]="headerConfiguration.mainText"
    [bgColor]="headerConfiguration.bgColor"
    [returnAble]="headerConfiguration.returnable"
    (returnEvent)="(headerConfiguration.returnEvent)"
    [dots]="{
      active: true
    }"
    (dotEvent)="openHeaderDialog()"
  ></app-helper-headerv2>

  <div class="helper-header-space"></div>

  <form class="search-bar-wrapper">
    <input
      type="text"
      name="item-search"
      class="input search-bar"
      placeholder="Busca por tag, articulo, referencia"
      [formControl]="itemSearchbar"
    />

    <button class="menu-btn">
      <svg
        class="menu-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="27"
        height="27"
        (click)="
          !executingMenuOpeningAnimation || !executingMenuOpeningAnimation
            ? openOrCloseMenu()
            : null
        "
      >
        <path
          d="M3.375 0A3.375 3.375 0 0 0 0 3.375v20.25A3.375 3.375 0 0 0 3.375 27h20.25A3.375 3.375 0 0 0 27 23.625V3.375A3.375 3.375 0 0 0 23.625 0H3.375Zm.844 8.438a.844.844 0 0 0 0 1.687H22.78a.844.844 0 0 0 0-1.688H4.22Zm2.531 5.906c0-.466.378-.844.844-.844h11.812a.844.844 0 0 1 0 1.688H7.594a.844.844 0 0 1-.844-.844Zm3.375 5.062c0-.466.378-.843.844-.843h5.062a.844.844 0 0 1 0 1.687H10.97a.844.844 0 0 1-.844-.844Z"
          fill-rule="evenodd"
          data-name="Path 28861"
        />
      </svg>

      <div
        class="pointer"
        [ngClass]="{
          opened: menuOpened
        }"
        [ngStyle]="{
          transitionDelay: menuOpened ? '0s' : '2.5s'
        }"
      ></div>

      <div
        class="menu-background-wrapper"
        [ngClass]="{
          show: menuOpened,
          animationRunning:
            executingMenuOpeningAnimation || executingMenuClosingAnimation
        }"
      >
        <div
          class="menu-background"
          [ngClass]="{
            opened: menuOpened
          }"
        ></div>
      </div>
    </button>
  </form>

  <div
    class="menu-content"
    [ngClass]="{
      visible: menuOpened
    }"
  >
    <div
      class="content"
      [ngClass]="{
        visible:
          menuOpened &&
          !executingMenuOpeningAnimation &&
          !executingMenuClosingAnimation,
        animationRunning:
          executingMenuOpeningAnimation || executingMenuClosingAnimation
      }"
      [ngStyle]="{
        transition: '0.5s height linear'
      }"
    >
      <div
        class="navigation-wrapper"
        [ngStyle]="{
          display:
            !menuOpened &&
            !(executingMenuOpeningAnimation || executingMenuClosingAnimation)
              ? 'none'
              : 'block'
        }"
      >
        <swiper [config]="menuNavigationSwiperConfig">
          <div
            class="menu-option swiper-item"
            [ngClass]="{
              selected: option.active
            }"
            *ngFor="let option of menuNavigationOptions; index as optionIndex"
            (click)="changeToMenuOption(optionIndex)"
          >
            {{ option.name }}
          </div>
        </swiper>
      </div>

      <ng-container *ngIf="activeMenuOptionIndex !== null">
        <ng-container
          [ngSwitch]="menuNavigationOptions[activeMenuOptionIndex].name"
        >
          <div
            class="metrics-grid"
            [ngStyle]="{
              display:
                !menuOpened &&
                !(
                  executingMenuOpeningAnimation || executingMenuClosingAnimation
                )
                  ? 'none'
                  : 'grid'
            }"
            *ngSwitchCase="'Items'"
          >
            <div class="card pointer" routerLink="/admin/merchant-items">
              <h2 class="amount quantity">
                {{ allItems ? allItems.length : "0" }}
              </h2>
              <h2 class="amount">EN TOTAL</h2>
            </div>

            <div
              class="card pointer"
              routerLink="/admin/merchant-items"
              [queryParams]="{ status: 'active' }"
            >
              <h2 class="amount quantity">
                {{
                  activeItems && activeItems.length > 0 ? activeItems.length : 0
                }}
              </h2>
              <h2 class="amount">VISIBLES</h2>
            </div>

            <div
              class="card pointer"
              routerLink="/admin/merchant-items"
              [queryParams]="{ status: 'disabled' }"
            >
              <h2 class="amount quantity">
                {{
                  inactiveItems && inactiveItems.length > 0
                    ? inactiveItems.length
                    : 0
                }}
              </h2>
              <h2 class="amount">INVISIBLES</h2>
            </div>
          </div>

          <ng-container *ngIf="saleflowCalendar">
            <div
              class="metrics-grid"
              [ngStyle]="{
                display:
                  !menuOpened &&
                  !(
                    executingMenuOpeningAnimation ||
                    executingMenuClosingAnimation
                  )
                    ? 'none'
                    : 'grid'
              }"
              *ngSwitchCase="'Citas'"
            >
              <div
                class="card pointer"
                [routerLink]="
                  '/admin/items-dashboard/reservations/' +
                  saleflowCalendar._id +
                  '/pasadas'
                "
              >
                <h2 class="amount quantity">
                  {{
                    saleflowCalendar.pastReservations
                      ? saleflowCalendar.pastReservations.length
                      : "0"
                  }}
                </h2>
                <h2 class="amount">PASADAS</h2>
              </div>

              <div
                class="card pointer"
                [routerLink]="
                  '/admin/items-dashboard/reservations/' +
                  saleflowCalendar._id +
                  '/futuras'
                "
              >
                <h2 class="amount quantity">
                  {{
                    saleflowCalendar.futureReservations
                      ? saleflowCalendar.futureReservations.length
                      : "0"
                  }}
                </h2>
                <h2 class="amount">FUTURAS</h2>
              </div>

              <div class="card pointer">
                <h2 class="amount quantity">
                  {{
                    !saleflowCalendar.noLimitsMode
                      ? saleflowCalendar.slotsAvailable
                      : "∞"
                  }}
                </h2>
                <h2 class="amount">SLOTS DISPONIBLES</h2>
              </div>
            </div>
          </ng-container>

          <div
            class="metrics-grid"
            [ngStyle]="{
              display:
                !menuOpened &&
                !(
                  executingMenuOpeningAnimation || executingMenuClosingAnimation
                )
                  ? 'none'
                  : 'grid'
            }"
            *ngSwitchCase="'Facturas'"
          >
            <div class="card unset">
              <h2 class="amount quantity">
                ${{
                  ordersTotal && ordersTotal.total
                    ? ordersTotal.total.toLocaleString("es-MX")
                    : "0"
                }}
              </h2>
              <h2 class="amount">INGRESOS TOTALES</h2>
            </div>

            <div class="card pointer" routerLink="/admin/orders">
              <h2 class="amount quantity">
                {{
                  ordersTotal && ordersTotal.length ? ordersTotal.length : "0"
                }}
              </h2>

              <h2 class="amount">FACTURAS</h2>
            </div>

            <div class="card unset">
              <h2 class="amount quantity">
                {{ saleflowBuyers ? saleflowBuyers.length : "0" }}
              </h2>

              <h2 class="amount">COMPRADORES</h2>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <!-- swiper de tags -->
  <div class="swiper-container">
    <swiper [config]="tagsSwiperConfig" *ngIf="tagsList.length > 0" #tagSwiper>
      <div
        class="tag-wrapper swiper-slide"
        style="width: 89px !important"
        *ngFor="let tag of filteredTagsList"
      >
        <div
          class="tag-image"
          (click)="goToCreateTag(tag._id)"
          [ngStyle]="{
            'background-image':
              tag.images?.length > 0
                ? 'url(' + tag.images[0] + ')'
                : 'url(/assets/images/noimage.png)'
          }"
        >
          <div
            class="badge"
            *ngIf="tag.status === 'disabled'"
            [ngStyle]="{
              'background-image': 'url(' + env + '/closed-eye-white.svg' + ')'
            }"
          ></div>
        </div>
        <div class="tag-id">#{{ tag.name }}</div>
      </div>
    </swiper>
  </div>

  <!-- HIGHLIGHTED ITEMS SWIPER-->
  <section
    class="highlited-items-area"
    *ngIf="filteredHighlightedItems.length > 0"
  >
    <div class="title-and-options">
      <h2 class="title">Destacados</h2>

      <div class="dot-trio" (click)="openItemManagementDialog()">
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
      </div>
    </div>

    <p class="subtitle" *ngIf="highlightedItems.length === 0">
      No tienes items destacados
    </p>

    <div class="highlited-items-swiper" *ngIf="highlightedItems.length > 0">
      <swiper [config]="highlightedConfigSwiper">
        <div
          *ngFor="let item of filteredHighlightedItems; let i = index"
          [ngStyle]="{
            width: 'auto',
            paddingBottom: '10px',
            paddingRight: '16.5px'
          }"
        >
          <app-saleflow-item
            [itemIndex]="i"
            [itemId]="item._id"
            [menuCallback]="itemMenuCallback"
            [type]="4"
            [imgURL]="item.images ? item.images[0] : ''"
            [price]="item.pricing"
            [itemParams]="item.params"
            [showPrice]="true"
            [dynamicStyles]="{
              itemContainer: {
                minWidth: '242px',
                height: '315px',
                margin: '0px'
              },
              simpleCard: {
                height: '100%'
              },
              itemImg: {
                height: '82.8571%'
              },
              infoArea: {
                height: '17.1429%'
              }
            }"
            (itemClicked)="goToDetail(item._id)"
          ></app-saleflow-item>
          <div class="blank-space"></div>
        </div>
      </swiper>
    </div>
  </section>

  <!--SHOWS ITEMS GROUPED BY TAGS-->
  <section
    class="items-by-tag-grid"
    *ngFor="let tagAndItemsGroup of filteredItemsPerTag"
  >
    <div class="title-and-options">
      <h2 class="title">{{ tagAndItemsGroup.tag.name }}</h2>

      <div class="dot-trio" (click)="openItemManagementDialog()">
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
      </div>
    </div>

    <p
      class="subtitle"
      style="max-width: 334px"
      *ngIf="tagAndItemsGroup.items.length === 0"
    >
      {{
        itemSearchbar.value === "" && tagAndItemsGroup.items.length === 0
          ? "No hay items enlazados a esta tag"
          : itemSearchbar.value !== "" && tagAndItemsGroup.items.length === 0
          ? "No hay items enlazados a esta tag que concuerden con el término de busqueda"
          : null
      }}
    </p>

    <div class="saleflows-item-grid" *ngIf="tagAndItemsGroup.items?.length">
      <app-saleflow-item
        [type]="'ADD_NEW_ITEM'"
        (itemClicked)="goToCreateItem()"
      ></app-saleflow-item>
      <div
        class="capsize"
        *ngFor="let item of tagAndItemsGroup.items; let itemIndex = index"
      >
        <app-saleflow-item
          [itemIndex]="itemIndex"
          [itemId]="item._id"
          [menuCallback]="itemMenuCallback"
          [type]="4"
          [inactive]="
            item.status != 'active' && item.status != 'featured' ? true : false
          "
          [imgURL]="item.images ? item.images[0] : ''"
          [price]="item.pricing"
          [showPrice]="true"
          [itemParams]="item.params"
          (itemClicked)="goToDetail(item._id)"
          [responsiveWidthVersion]="true"
        ></app-saleflow-item>
      </div>
    </div>
  </section>

  <!--SHOW ITEMS WITHOUT TAG-->
  <section class="items-without-tags">
    <div class="title-and-options">
      <h2 class="title">Items sin tags</h2>

      <div class="dot-trio" (click)="openItemManagementDialog()">
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
        <div
          class="dot"
          [ngStyle]="{
            'background-color': '#2874ad',
            margin: '0 2.5px'
          }"
        >
           
        </div>
      </div>
    </div>

    <p
      class="subtitle"
      style="max-width: 334px"
      *ngIf="!filteredItemsWithoutTags?.length"
    >
      {{
        itemSearchbar.value === "" && !filteredItemsWithoutTags?.length
          ? "No hay items sin tags"
          : itemSearchbar.value !== "" && !filteredItemsWithoutTags?.length
          ? "No hay items sin tags que concuerden con el término de busqueda"
          : null
      }}
    </p>

    <div class="saleflows-item-grid" *ngIf="filteredItemsWithoutTags?.length">
      <div
        class="capsize"
        *ngFor="let item of filteredItemsWithoutTags; let itemIndex = index"
      >
        <app-saleflow-item
          [itemIndex]="itemIndex"
          [itemId]="item._id"
          [type]="4"
          [inactive]="
            item.status != 'active' && item.status != 'featured' ? true : false
          "
          [imgURL]="item.images ? item.images[0] : ''"
          [price]="item.pricing"
          [showPrice]="true"
          [itemParams]="item.params"
          [responsiveWidthVersion]="true"
          (itemClicked)="goToDetail(item._id)"
          [menuCallback]="itemMenuCallback"
        ></app-saleflow-item>
      </div>
    </div>
  </section>

  <div
    class="create-btn"
    [ngClass]="{
      invisible: menuOpened
    }"
    (click)="goToCreateItem()"
  >
    Crea
  </div>
</div>
