<div class=" dashboard-page container" (scroll)="infinitePagination()">
  <div *ngIf="tutorialEnabled" class="blur"></div>
  <div *ngIf="tutorialEnabled" class="dialog">
    <p class="tutorial-title">Creas facturas, llevas el control y si quieres compártela con el comprador.</p>
    <div class="tutorial-button-holder">
      <button class="ok-button" (click)="tutorialEnabled = false">Ok</button>
      <button class="tutorial-button" (click)="toggleTutorial(true)">
        No Mostrar Tutorial
      </button>
      
    </div>
    <div class="img-container">
      <img src="../../../../../assets/images/person-default.png">
    </div>
    <p class="tutorial-text">
      Aquí estarán las facturas, el status de los pedidos y el reporte de los ingresos.
    </p>
    
  </div>
  <div class="header" *ngIf="!searchOpened">
    <div class="flex">
      <img class="box-icon" src="../../../../../assets/images/box-lines-icon.png" alt="" />
      <p>ORDENES & PEDIDOS</p>
    </div>
    <div class="right-icons">
      <mat-icon class="camera-icon grey">search</mat-icon>
      <span >X</span>
    </div>
  </div>
  <div class="header" *ngIf="searchOpened">
    <div class="flex">
      <img class="box-icon" (click)="onCloseSearchbar()" src="../../../../../assets/icons/close-button.svg" alt="" />
      <p>ORDENES & PEDIDOS</p>
    </div>
  </div>
  <!-- <header *ngIf="searchOpened">
    <button class="btn btn-close" (click)="onCloseSearchbar()">
      <img src="../../../../../assets/icons/close-button.svg" alt="" />
    </button>
  </header> -->
  <div>
    <swiper
      #ordersSwiper
      [config]="swiperConfig"
    >
    <div class="swipe-item-selected">
      <span>
        Admin de ecommerce
      </span>
    </div>
    <div class="swipe-item">
      <span>
        Admin de Comunidad
      </span>
    </div>
    <div class="swipe-item">
      <span>
       Miembros
      </span>
    </div>
    </swiper>
  </div>
  <div class="search-menu" *ngIf="tutorialEnabled">
    <img
        alt="camara"
        class="camera-icon grey"
        src="{{ env }}/grey-camera.png"
        />
        <input title="file" type="file" id="file" 
          [style.display]="'none'" 
          multiple [accept]="[
            '.png',
            '.jpg',
            '.jpeg',
            '.webp',
            '.webm',
            '.mp4',
            '.m4v',
            '.mpg',
            '.mpeg',
            '.mpeg4',
            '.mov',
            '.3gp',
            '.mts',
            '.m2ts',
            '.mxf'
            ]" 
        /> 
      <div class="rounded-add-icon" *ngIf="tutorialEnabled">
        <mat-icon class="camera-icon grey" [ngStyle]="{ color: 'white' }">add</mat-icon>
      </div>
      <div class="add-icon" *ngIf="!tutorialEnabled">
        <mat-icon class="camera-icon grey" [ngStyle]="{ color: 'white' }">add</mat-icon>
      </div>
 
  <form
      class="search-bar-wrapper"
      style="margin-bottom: 21px"
    >
    <div class="filters">
      <div class="option">
        <img
        class="filter-icon"
        [src]="assetsFolder + '/funnel-filter.png'"
        alt="open internal information"
      />
      </div>
    </div>
      <input
        type="text"
        name="item-search"
        class="input search-bar"
        [placeholder]="placeholder"
        [formControl]="itemSearchbar"
      />
    </form>
  </div>
  <div class="search-menu" *ngIf="!tutorialEnabled">
    <img
        alt="camara"
        class="camera-icon grey"
        src="{{ env }}/grey-camera.png"
        (click)="emitFileInputClick()"
        />
        <input title="file" type="file" id="file" 
          [style.display]="'none'" 
          (change)="loadFile($event)" 
          multiple [accept]="[
            '.png',
            '.jpg',
            '.jpeg',
            '.webp',
            '.webm',
            '.mp4',
            '.m4v',
            '.mpg',
            '.mpeg',
            '.mpeg4',
            '.mov',
            '.3gp',
            '.mts',
            '.m2ts',
            '.mxf'
            ]" 
        /> 
      <div class="rounded-add-icon" *ngIf="tutorialEnabled">
        <mat-icon class="camera-icon grey" [ngStyle]="{ color: 'white' }">add</mat-icon>
      </div>
      <div class="add-icon" *ngIf="!tutorialEnabled">
        <mat-icon class="camera-icon grey" [ngStyle]="{ color: 'white' }">add</mat-icon>
      </div>
 
  <form
      class="search-bar-wrapper"
      style="margin-bottom: 21px"
    >
    <div class="filters">
      <div class="option">
        <img
        class="filter-icon"
        [src]="assetsFolder + '/funnel-filter.png'"
        alt="open internal information"
      />
      </div>
    </div>
      <input
        type="text"
        (click)="showSearch()"
        name="item-search"
        class="input search-bar"
        [placeholder]="placeholder"
        [formControl]="itemSearchbar"
      />
    </form>
  </div>
  <div class="search-opened" *ngIf="searchOpened">
    <div class="dates-container">
      <div class="progress-container">
        <p class="selection-text">{{deliveryTimePlaceholder}}</p>
        <ng-container *ngFor="let item of deliveryTime">
          <div class="progress-item">
            <div
            class="progress"
            [ngClass]="{ 'progress-selected': item.selected }"
            (click)="selectDeliveryTime(item.id)"
            >
              <span>De {{item.estimatedDeliveryTime.from}} a {{item.estimatedDeliveryTime.until}} horas</span>
              <span>({{item.count}})</span>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
    
    <div class="dates-container">
      <div class="progress-container">
        <p class="selection-text">{{deliveryZonePlaceholder}}</p>
        <div class="progress-item">
          <div
            class="progress"
            [ngClass]="{ 'progress-selected': delivery.selected }"
            (click)="(delivery.selected === !delivery.selected)"
          >
            <span>Delivery </span>
            <span>({{ delivery.amount || 0 }})</span>
          </div>
        </div>
        <div class="progress-item">
          <div
            class="progress"
            [ngClass]="{ 'progress-selected': pickUp.selected }"
            (click)="(pickUp.selected)"
          >
            <span>PickUp </span>
            <span>({{ pickUp.amount || 0 }})</span>
          </div>
        </div>
        <div *ngFor="let zone of deliveryZones" class="progress-item">
          <div
            class="progress"
            [ngClass]="{ 'progress-selected': zone.selected }"
            (click)="selectZone(zone._id)"
          >
            <span>{{ zone.zona }} </span>
            <span>({{ findAmount(zone._id) }})</span>
          </div>
        </div>
      </div>
    </div>

    <div class="dates-container">
      <div class="progress-container">
        <p class="selection-text">{{paymentStatusPlaceholder}}</p>
        <ng-container *ngFor="let item of paymentStatus">
          <div class="progress-item">
            <div
            class="progress"
            [ngClass]="{ 'progress-selected': item.selected }"
            (click)="selectPaymentStatus(item.id)"
            >
              <span>{{parseOrderPaymentStatus(item.name)}}</span>
              <span>({{item.count}})</span>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <div class="dates-container">
      <div class="progress-container-status">
        <p class="selection-text">{{progressPlaceHolder}}</p>
        <ng-container *ngFor="let i of progress">
          <div class="progress-items" [ngClass]="orderDeliveryStatus(i.name).replace(' ', '-')">
            <div
              class="progress"
              [ngClass]="i.selected ? orderDeliveryStatus(i.name).replace(' ', '-') + '-selected' : ''"
              (click)="selectProgress(i.id)"
            >
              <span>{{ orderDeliveryStatus(i.name) }} </span>
              <span>{{ "(" + orderDeliveryLength(i.name) + ")" }}</span>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="total-results">
      <p>{{orders.length}} facturas filtradas</p>
    </div>
  </div>
  
  <div class="content">
    <div
      class="content-cards-container"
      *ngFor="let orderByMonth of ordersByMonth"
    >
      <p class="content-title">
        {{ orderByMonth.month }}
      </p>
      <div
        *ngFor="let order of orderByMonth.orders; index as i"
        (click)="goToOrderDetail(order._id, i)"
      >
      <div class="content-card">
        <div class="display-flex">
          <div class="content-card-info">
            <div class="content-card-title">
              <app-order-status-badge [status]="order.orderStatusDelivery"></app-order-status-badge>
              <p>
                {{
                  order.user != null
                    ? order.user.name || order.user.email || order.user.phone
                    : "Sin nombre"
                }}
              </p>
            </div>
            <p class="content-card-extra-info">
               {{ shortFormatID(order.dateId) }}, hace {{ dateHandler(order.createdAt) }}
            </p>
            <p class="content-card-extra-info">
              {{getItemsName(order.items)}}
           </p>
          </div>
        </div>
        <div class="right-side">
          <p class="content-card-price">
            ${{ calcTotal(order.subtotals).toFixed(2) }}
          </p>
          <img
                *ngIf="order.orderType === 'external'"
                alt="camara"
                class="camera-icon grey"
                src="{{ env }}/grey-camera.png"
                (click)="emitFileInputClick()"
              />
          <!-- <p class="content-card-extra-info">
            {{ order.items.length }} artículos
          </p> -->
        </div>
      </div>
      <hr class="line">
      </div>
    </div>
  </div>
  <footer class="bottom-footer" (click)="openDatePicker()">
    <mat-form-field appearance="fill" style="display: none">
      <mat-label>Enter a date range</mat-label>
      <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
        <input matStartDate formControlName="start" placeholder="Start date" />
        <input
          matEndDate
          formControlName="end"
          (dateChange)="onDateChange()"
          placeholder="End date"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>
    <p *ngIf="startDateLabel === ''">Filtro por fechas</p>
    <p *ngIf="startDateLabel !== ''">{{startDateLabel}} a {{endDateLabel}}</p>
    <p class="benefits">Beneficio: ${{benefit | CurrencyPipe}}</p>
  </footer>
</div>
