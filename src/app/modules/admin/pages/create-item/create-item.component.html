<div class="component">
  <header class="flex-between">
    <a (click)="goBack()"><i class="fas fa-chevron-left"></i></a>

    <!--  *ngIf="itemForm.valid" iba aqui abajo -->
    <button class="dot-trio" (click)="onOpenDialog()">
      <div class="dot"> </div>
      <div class="dot"> </div>
      <div class="dot"> </div>
    </button>
  </header>
  <main>
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
      <section>
        <div class="fullScreenSwiper" *ngIf="imageField.length">
          <div class="shadowWrapper">
            <swiper [config]="swiperConfig">
              <label
                *ngFor="let item of imageField; let i = index"
                [style.background]="sanitize(item)"
                [for]="'filemultiple'"
                class="item"
                [ngClass]="{ error: error[0] }"
              ></label>
            </swiper>
          </div>
        </div>
        <input
          [id]="'filemultiple'"
          (change)="fileProgressMultiple($event)"
          type="file"
          class="d-none"
          accept="image/*"
          multiple
          [accept]="['.png', '.jpg', '.jpeg']"
        />
        <input formControlName="images" style="display: none" />
        <ng-container *ngIf="!imageField.length">
          <label
            [style.background]="sanitize('')"
            [for]="'filemultiple'"
            class="file"
            [ngClass]="{ error: error[0] }"
          >
            Adiciona la o las imágenes (opcional)
          </label>
        </ng-container>
      </section>

      {{ formattedPricing | json }}

      <ng-container *ngIf="status === 'complete'">
        <ng-container *ngIf="!hasParams">
          <section class="form-group p-side">
            <div class="flex-between" style="margin-bottom: 8px">
              <span class="info-label">Info</span>
              <button type="button" class="dot-trio">
                <div class="dot blue"> </div>
                <div class="dot blue"> </div>
                <div class="dot blue"> </div>
              </button>
            </div>
            <div class="name-and-price-wrapper">
              <div class="name-wrapper">
                <input
                  class="input-text"
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Nombre (opcional)"
                  formControlName="name"
                />
              </div>
              <div style="flex-basis: 35.12%">
                <app-currency-input
                  [fieldStyles]="{
                    boxShadow: 'lightgrey 0px 3px 8px inset'
                  }"
                  [initialValue]="
                    parseFloat(formattedPricing.item.substring(1))
                  "
                  (onInputEvent)="
                    handleCurrencyInput(itemForm, 'pricing', $event)
                  "
                ></app-currency-input>
              </div>
            </div>
            <textarea
              placeholder="Descripción (opcional)"
              class="textarea"
              formControlName="description"
            ></textarea>
          </section>
        </ng-container>
        <ng-container *ngIf="hasParams">
          <div
            formArrayName="params"
            *ngIf="getArrayLength(itemForm, 'params')"
          >
            <div
              *ngFor="
                let paramsControl of getControls(itemForm, 'params');
                index as i
              "
              [formGroupName]="i"
            >
              <div
                formArrayName="values"
                *ngIf="getArrayLength(paramsControl, 'values')"
              >
                <section
                  class="form-group p-side"
                  *ngFor="
                    let valuesControl of getControls(paramsControl, 'values');
                    index as j
                  "
                  [formGroupName]="j"
                >
                  <div class="name-and-price-wrapper">
                    <div class="name-wrapper">
                      <input
                        class="input-text"
                        type="text"
                        formControlName="name"
                        placeholder="Nombre (opcional)"
                        (keypress)="dynamicInputKeyPress(j)"
                      />
                    </div>
                    <div style="flex-basis: 35.12%">
                      <app-currency-input
                        [fieldStyles]="{
                          boxShadow: 'lightgrey 0px 3px 8px inset'
                        }"
                        [initialValue]="
                          parseFloat(formattedPricing.values[j].substring(1))
                        "
                        (onInputEvent)="
                          handleCurrencyInput(valuesControl, 'price', $event, j)
                        "
                      ></app-currency-input>
                    </div>
                  </div>

                  <div class="description-and-images-wrapper">
                    <div class="description-wrapper">
                      <textarea
                        placeholder="Descripción (opcional)"
                        class="textarea"
                        formControlName="description"
                        (keypress)="dynamicInputKeyPress(j)"
                      ></textarea>
                    </div>

                    <div class="image-wrapper">
                      <app-image-input
                        [id]="'image' + j"
                        [useSwiper]="false"
                        [allowedTypes]="['png', 'jpg', 'jpeg']"
                        [multiple]="true"
                        innerLabel="Imagen o
                        imágenes"
                        [expandImage]="true"
                        [uploadImagesWithoutPlaceholderBox]="true"
                        [allowDeletion]="true"
                        [max]="1"
                        [containerStyles]="{
                          width: 'auto',
                          height: 'auto'
                        }"
                        [fileStyles]="{
                          width: '100%',
                          height: '122px',
                          border: 'none',
                          color: '#A1A1A1',
                          boxShadow: 'lightgrey 0px 3px 8px inset',
                          justifyContent: 'flex-start',
                          alignItems: 'flex-start',
                          paddingLeft: '27px',
                          paddingTop: '31px',
                          textAlign: 'left',
                          fontFamily: 'RobotoMedium',
                          fontWeight: 'normal',
                          marginLeft: 'auto'
                        }"
                        (onFileInputBase64Multiple)="
                          handleImageInput(valuesControl, 'image', $event, 'ADD')
                        "
                        (onFileDeletion)="
                          handleImageInput(valuesControl, 'image', $event, 'DELETE')
                        "
                      ></app-image-input>
                    </div>
                  </div>
                </section>
              </div>
              <br /><br />
            </div>
          </div>
        </ng-container>
      </ng-container>
    </form>
  </main>
  <footer [ngClass]="{ disabled: !itemForm.valid }" *ngIf="!hasParams">
    <button class="back" (click)="goBack()">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="save" (click)="onSubmit()">Salvar</button>
  </footer>

  <footer *ngIf="hasParams">
    <button class="back" (click)="goBack()">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="save" (click)="onSubmit()">Salvar</button>
  </footer>
</div>
