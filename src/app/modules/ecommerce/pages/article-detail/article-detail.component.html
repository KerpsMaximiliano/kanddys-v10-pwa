<div class="container" *ngIf="itemData">
  <button class="fixed-top-button left" (click)="back()">
    <img [src]="env + '/arrow-double-up.svg'" alt="Volver" />
  </button>
  <button
    *ngIf="itemsAmount"
    class="fixed-top-button right"
    mat-raised-button
    (click)="goToCheckout()"
    [matBadge]="itemsAmount"
    matBadgePosition="after"
  >
    <img [src]="env + '/carrito_blanco.svg'" alt="Volver" />
  </button>
  <div class="media-swiper-wrapper">
    <div
      #swiperContainer
      [ngStyle]="{
        width: '100%',
        height: (swiperContainer.clientWidth * 10) / 7 + 'px'
      }"
    >
      <swiper
        [config]="swiperConfig"
        #mediaSwiper
        (slideChange)="updateCurrentSlideData($event)"
      >
        <ng-container *ngIf="itemData.media && itemData.media.length > 0">
          <ng-container *ngFor="let media of itemData.media">
            <div
              class="entity-image"
              *ngIf="media.type === 'IMAGE'"
              [ngStyle]="{
                backgroundImage: 'url(' + media.src + ')'
              }"
            ></div>

            <video
              *ngIf="media.type === 'VIDEO'"
              [id]="'media' + currentMediaSlide"
              (click)="playVideoOnFullscreen('media' + currentMediaSlide)"
              [src]="media.src"
              [ngStyle]="{
                height: 'calc(100vh - 49px)'
              }"
            ></video>
          </ng-container>
        </ng-container>
      </swiper>
    </div>
    <div class="bottom-user-actions-panel">
      <button class="text-container">
        <p class="top-text" (click)="openInfoDialog()">
          {{
            itemData.name?.length > 30
              ? (itemData.name.trim() | slice : 0 : 30) + "..."
              : itemData.name
          }}
        </p>

        <p
          class="bottom-text"
          *ngIf="itemData.description"
          (click)="openInfoDialog()"
        >
          {{
            itemData.description.length > 100
              ? (itemData.description.trim() | slice : 0 : 100) + "..."
              : itemData.description
          }}
          <span *ngIf="itemData.description.length > 100" style="color: #82f18d"
            >Ver más</span
          >
        </p>
      </button>
      <div class="inner-wrapper-top">
        <div
          class="current-media-shown-indicators"
          [style]="{
            'grid-template-columns': '' + fractions + ''
          }"
        >
          <ng-container *ngIf="itemData.images.length > 0">
            <div
              class="indicator"
              [ngClass]="{
                active: imageIndex === currentMediaSlide
              }"
              *ngFor="let image of itemData.images; let imageIndex = index"
            ></div>
          </ng-container>
        </div>
        <div class="pricing-actions">
          <h3 class="item-price">
            RD $ {{ itemData.pricing | number : "1.2-2" }}
          </h3>
          <div class="icons-flex">
            <button class="round-button" (click)="share()">
              <img
                [src]="env + '/upload.svg'"
                alt="Contenedor con flecha saliendo"
              />
            </button>
          </div>
        </div>
        <button
          class="cart-btn"
          (click)="saveProduct()"
          *ngIf="doesModuleDependOnSaleflow"
          [ngClass]="{
            inCart: isItemInCart
          }"
        >
          <mat-icon>{{
            isItemInCart ? "remove_shopping_cart" : "add_shopping_cart"
          }}</mat-icon>
          <span>
            {{
              isItemInCart
                ? "Este artículo está en tu pre-factura"
                : "Adiciónalo a la factura"
            }}
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="container post-data"
  [ngStyle]="{
    height: 'calc(100vh - 49px)'
  }"
  *ngIf="postData"
>
  <div class="media-swiper-wrapper">
    <swiper
      [config]="swiperConfig"
      #mediaSwiper
      (slideChange)="updateCurrentSlideData($event)"
    >
      <ng-container *ngFor="let slide of postSlides">
        <ng-container *ngIf="slide.type === 'poster' && !slide.isVideo">
          <div
            class="entity-image"
            [ngStyle]="{
              backgroundImage: 'url(' + slide.media + ')'
            }"
          ></div>
        </ng-container>

        <ng-container *ngIf="slide.type === 'poster' && slide.isVideo">
          <video
            controls
            [src]="slide.media"
            [ngStyle]="{
              height: 'calc(100vh - 49px)'
            }"
          ></video>
        </ng-container>

        <div *ngIf="slide.type === 'audio'" class="audio">
          <div class="audio-container">
            <svg
              class="audio-file"
              xmlns="http://www.w3.org/2000/svg"
              version="1.0"
              width="500"
              height="500"
              viewBox="0 0 75 75"
            >
              <path
                d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z"
                style="
                  stroke: #111;
                  stroke-width: 5;
                  stroke-linejoin: round;
                  fill: #111;
                "
              />
              <path
                d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6"
                style="
                  fill: none;
                  stroke: #111;
                  stroke-width: 5;
                  stroke-linecap: round;
                "
              />
            </svg>
            <audio controls="controls">
              <source [src]="slide.media" />
            </audio>
          </div>
        </div>
      </ng-container>
    </swiper>
  </div>

  <div
    class="bottom-user-actions-panel"
    [ngStyle]="{
      transform: 'translateY(130px)'
    }"
  >
    <div class="inner-wrapper-top">
      <div
        class="current-media-shown-indicators"
        [style]="{
          'grid-template-columns': '' + fractions + ''
        }"
      >
        <ng-container *ngIf="entity === 'item' && itemData.images?.length > 0">
          <div
            class="indicator"
            [ngClass]="{
              active: imageIndex === currentMediaSlide
            }"
            *ngFor="let image of itemData.images; let imageIndex = index"
          ></div>
        </ng-container>

        <ng-container *ngIf="entity === 'post' && postSlides.length > 0">
          <div
            class="indicator"
            [ngClass]="{
              active: slideIndex === currentMediaSlide
            }"
            *ngFor="let slide of postSlides; let slideIndex = index"
          ></div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
