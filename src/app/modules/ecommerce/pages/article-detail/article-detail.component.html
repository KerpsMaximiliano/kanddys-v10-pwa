<div class="container" *ngIf="itemData || tagData">
  <button class="fixed-top-button left" (click)="back()">
    <img [src]="env + '/arrow-double-up.svg'" alt="Volver" />
  </button>

  <div class="media-swiper-wrapper">
    <div
      #swiperContainer
      [ngStyle]="{
        width: '100%',
        height: (swiperContainer.clientWidth * 10) / 7 + 'px'
      }"
    >
      <swiper
        [config]="swiperConfig"
        #mediaSwiper
        (slideChange)="updateCurrentSlideData($event)"
      >
        <ng-container *ngIf="itemData?.media && itemData?.media.length > 0">
          <ng-container *ngFor="let media of itemData.media; index as i">
            <div
              class="entity-image"
              *ngIf="media.type === 'IMAGE'"
              [ngStyle]="{
                backgroundImage: 'url(' + media.src + ')'
              }"
            ></div>

            <div class="video-wrapper" *ngIf="media.type === 'VIDEO'">
              <img
                src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/playIcon.svg"
                alt="play"
                class="playVideoIcon"
                style="
                  padding: 7rem !important;
                  z-index: 99;
                  max-width: 300px;
                  margin: auto;
                  left: 0;
                  right: 0;
                "
                (click)="playVideoOnFullscreen('media' + i)"
              />

              <video
                [id]="'media' + i"
                (click)="playVideoOnFullscreen('media' + i)"
                [src]="media.src"
                [ngStyle]="{
                  height: 'calc(100vh - 49px)'
                }"
              ></video>
            </div>
          </ng-container>
        </ng-container>
        <ng-container *ngIf="tagData?.images?.length">
          <ng-container *ngFor="let media of tagData.images">
            <div
              class="entity-image"
              [ngStyle]="{
                backgroundImage: 'url(' + media + ')'
              }"
            ></div>
          </ng-container>
        </ng-container>
      </swiper>
    </div>
    <div class="bottom-user-actions-panel">
      <button class="text-container">
        <p class="top-text" *ngIf="itemData?.name || tagData?.name">
          {{
            itemData &&
              (itemData.name?.length > 30
                ? (itemData.name.trim() | slice : 0 : 30) + "..."
                : itemData.name)
          }}
          {{
            tagData &&
              (tagData.name?.length > 30
                ? (tagData.name.trim() | slice : 0 : 30) + "..."
                : tagData.name)
          }}
        </p>

        <p class="bottom-text" *ngIf="itemData?.description || tagData?.notes">
          {{
            itemData &&
              (itemData.description.length > 100
                ? (itemData.description.trim() | slice : 0 : 100) + "..."
                : itemData.description)
          }}
          {{
            tagData &&
              (tagData.notes.length > 100
                ? (tagData.notes.trim() | slice : 0 : 100) + "..."
                : tagData.notes)
          }}
        </p>
      </button>
      <div class="inner-wrapper-top">
        <div
          class="current-media-shown-indicators"
          [style]="{
            'grid-template-columns': '' + fractions + ''
          }"
        >
          <ng-container *ngIf="itemData?.images?.length">
            <div
              class="indicator"
              [ngClass]="{
                active: imageIndex === currentMediaSlide
              }"
              *ngFor="let image of itemData?.images; let imageIndex = index"
            ></div>
          </ng-container>
          <ng-container *ngIf="tagData?.images?.length">
            <div
              class="indicator"
              [ngClass]="{
                active: imageIndex === currentMediaSlide
              }"
              *ngFor="let image of tagData.images; let imageIndex = index"
            ></div>
          </ng-container>
        </div>
        <div class="pricing-actions">
          <h3 class="item-price" *ngIf="itemData">
            RD $ {{ itemData.pricing | number : "1.2-2" }}
          </h3>
          <span *ngIf="!itemData"></span>
          <div class="icons-flex">
            <button class="round-button" (click)="share()">
              <img
                [src]="env + '/upload.svg'"
                alt="Contenedor con flecha saliendo"
              />
            </button>
            <!-- <button class="round-button">
              <img [src]="env + '/heart.svg'" alt="corazon" />
            </button> -->
          </div>
        </div>

        <button
          class="cart-btn"
          (click)="saveProduct()"
          *ngIf="
            doesModuleDependOnSaleflow &&
            itemData &&
            isSignup !== true &&
            isCreateArticle !== true
          "
          [ngClass]="{
            inCart: isItemInCart
          }"
          [ngStyle]="{
            width: itemsAmount ? '75%' : '100%',
            borderTopRightRadius: itemsAmount ? '11px' : '0'
          }"
        >
          <span>
            {{
              isItemInCart
                ? "Este artículo está en tu pre-factura"
                : "Adiciónalo a la factura"
            }}
          </span>
          <mat-icon>{{
            isItemInCart ? "remove_shopping_cart" : "add_shopping_cart"
          }}</mat-icon>
        </button>

        <button
          *ngIf="isSignup === true"
          style="
            width: 100%;
            padding: 12px 0px;
            background-color: #fed230;
            text-align: center;
            font-size: 17px;
            font-family: SFProBold;
            cursor: pointer;
          "
          (click)="showDialog()"
        >
          Crea tu primer artículo (ganas 3,000 DoCoins)
        </button>
        <button
          *ngIf="isCreateArticle === true"
          style="
            width: 100%;
            padding: 12px 0px;
            background-color: #fed230;
            text-align: center;
            font-size: 17px;
            font-family: SFProBold;
            cursor: pointer;
          "
          (click)="articleDialog()"
        >
          Abrir diálogo
        </button>

        <button
          *ngIf="itemsAmount && mode != 'image-preview' && isSignup !== true"
          class="bottom-button right"
          mat-raised-button
          (click)="goToCheckout()"
          [matBadge]="itemsAmount"
          matBadgePosition="after"
          matBadgeSize="small"
        >
          <img [src]="env + '/carrito_blanco.svg'" alt="Volver" />
        </button>

        <a
          class="cart-btn"
          [routerLink]="['../../../collections', tagData._id]"
          *ngIf="tagData"
          [ngClass]="{
            tagView: true,
            inCart: isItemInCart
          }"
        >
          Mira la colección
        </a>
      </div>
    </div>
  </div>
</div>

<div class="container post-data" *ngIf="postData">
  <button
    class="fixed-top-button"
    [ngStyle]="{
      left: '7px'
    }"
    (click)="back()"
  >
    <img [src]="env + '/arrow-double-up.svg'" alt="Flecha doble hacia arriba" />
  </button>

  <div class="media-swiper-wrapper">
    <div
      #swiperContainer
      [ngStyle]="{
        width: '100%',
        height: (swiperContainer.clientWidth * 10) / 7 + 'px'
      }"
    >
      <swiper
        [config]="swiperConfig"
        #mediaSwiper
        (slideChange)="updateCurrentSlideData($event)"
      >
        <ng-container *ngFor="let slide of postSlides; let i = index">
          <ng-container *ngIf="slide.type === 'poster' && !slide.isVideo">
            <div
              class="entity-image"
              [ngStyle]="{
                'background-image': 'url(' + slide.media + ')'
              }"
            >
              <div
                class="post-content-minimized"
                *ngIf="postContentMinimized"
                (click)="postContentMinimized = !postContentMinimized"
              >
                <p class="title2" *ngIf="slide.title">{{ slide.title }}</p>
                <p class="subtitle2" *ngIf="slide.text">
                  {{
                    slide.text.length > 24
                      ? slide.text.slice(0, 24) + "..."
                      : slide.text
                  }}
                </p>
              </div>

              <div
                class="post-content-maximized"
                *ngIf="!postContentMinimized"
                (click)="postContentMinimized = !postContentMinimized"
              >
                <p class="title2" *ngIf="slide.title">{{ slide.title }}</p>
                <p class="subtitle2" *ngIf="slide.text">
                  {{ slide.text }}
                </p>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="slide.type === 'text'">
            <div class="text-content">
              <div class="content">
                <p class="title2" *ngIf="slide.title">{{ slide.title }}</p>
                <p class="subtitle2" *ngIf="slide.text">{{ slide.text }}</p>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="slide.type === 'poster' && slide.isVideo">
            <video
              [id]="'post-media' + i"
              [src]="slide.media"
              (click)="playVideoOnFullscreen('post-media' + i)"
            ></video>
          </ng-container>

          <div *ngIf="slide.type === 'audio'" class="audio">
            <div class="audio-container">
              <svg
                class="audio-file"
                xmlns="http://www.w3.org/2000/svg"
                version="1.0"
                width="500"
                height="500"
                viewBox="0 0 75 75"
              >
                <path
                  d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z"
                  style="
                    stroke: #111;
                    stroke-width: 5;
                    stroke-linejoin: round;
                    fill: #111;
                  "
                />
                <path
                  d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6"
                  style="
                    fill: none;
                    stroke: #111;
                    stroke-width: 5;
                    stroke-linecap: round;
                  "
                />
              </svg>
              <audio controls="controls">
                <source [src]="slide.media" />
              </audio>
            </div>
          </div>
        </ng-container>
      </swiper>
    </div>
  </div>

  <div
    class="bottom-user-actions-panel"
    [ngStyle]="{
      height: '8.3455vh'
    }"
  >
    <div class="inner-wrapper-top post">
      <div
        class="current-media-shown-indicators"
        [style]="{
          'grid-template-columns': '' + fractions + ''
        }"
      >
        <ng-container *ngIf="entity === 'item' && itemData.images?.length > 0">
          <div
            class="indicator"
            [ngClass]="{
              active: imageIndex === currentMediaSlide
            }"
            *ngFor="let image of itemData.images; let imageIndex = index"
          ></div>
        </ng-container>

        <ng-container *ngIf="entity === 'post' && postSlides.length > 0">
          <div
            class="indicator"
            [ngClass]="{
              active: slideIndex === currentMediaSlide
            }"
            *ngFor="let slide of postSlides; let slideIndex = index"
          ></div>
        </ng-container>
      </div>

      <div class="icons-flex-2">
        <button class="round-button" (click)="share()">
          <img
            [src]="env + '/upload.svg'"
            style="filter: brightness(10)"
            alt="Contenedor con flecha saliendo"
          />
        </button>
        <!-- <button class="round-button">
          <img [src]="env + '/heart.svg'" alt="corazon" />
        </button> -->
      </div>
    </div>
  </div>
</div>
