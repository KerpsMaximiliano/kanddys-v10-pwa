<div class="container">
  <header>
    <div class="close" (click)="back()">X</div>
    <h2>
      {{
        !item
          ? "Nuevo artículo para vender"
          : totalSells > 0
          ? "Artículo que se ha vendido"
          : "Detalles del articulo"
      }}
    </h2>

    <div *ngIf="item" class="options-wrapper">
      <img
        src="../../../../../assets/icons/switch-on.svg"
        *ngIf="item.status != 'disabled'"
      />
      <img
        src="../../../../../assets/icons/switch-off.svg"
        *ngIf="item.status == 'disabled'"
      />
      <img
        [src]="
          currentView === 'ITEM_FORM'
            ? assetsFolder + '/icon_info.png'
            : assetsFolder + '/dropdown_icon.png'
        "
        alt="open internal information"
        (click)="
          currentView =
            currentView === 'ITEM_FORM' ? 'ITEM_METRICS' : 'ITEM_FORM'
        "
      />
      <img [src]="assetsFolder + '/dots-black.svg'" alt="more options" />
    </div>
  </header>

  <main [formGroup]="itemFormData">
    <ng-container [ngSwitch]="currentView">
      <ng-container *ngSwitchCase="'ITEM_FORM'">
        <div class="disabled-item-container" *ngIf="item?.status == 'disabled'">
          El artículo está oculto
        </div>

        <section *ngIf="true">
          <h2 class="section-title">DATOS POR LLENAR</h2>

          <ng-container *ngIf="itemSlides.length === 0">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Slides visuales',
                  iconCallback: emitFileInputClick
                }
              "
            >
            </ng-container>
          </ng-container>

          <ng-container *ngIf="itemFormData.controls['pricing'].value === 0">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Precio',
                  iconCallback: openFormForField,
                  fieldNameForCallback: 'PRICE'
                }
              "
            >
            </ng-container>
          </ng-container>
        </section>

        <section *ngIf="true">
          <h2 class="section-title">DATOS LLENOS</h2>

          <div
            *ngIf="itemFormData.controls['pricing'].value !== 0"
            class="price-wrapper no-shadows"
          >
            <app-currency-input
              [innerLabel]="'Precio*'"
              [innerLabelStyles]="{
                fontFamily: 'InterLight',
                fontStyle: 'italic',
                fontSize: '13px'
              }"
              [fieldStyles]="{
                boxShadow: 'none',
                backgroundColor: 'white',
                borderRadius: '6px',
                padding: '8px 0px'
              }"
              [initialValue]="itemFormData.controls['pricing'].value"
              (onInputEvent)="updateItemPrice($event)"
              placeholderColor="#7B7B7B"
              currencyLabel=""
            ></app-currency-input>
          </div>

          <div class="field-text" *ngIf="itemFormData.controls['title'].value">
            <label for="">Texto principal y centralizado</label>

            <input
              type="text"
              placeholder="Escribe"
              [formControlName]="'title'"
            />
          </div>

          <div
            class="field-text"
            *ngIf="itemFormData.controls['description'].value"
            style="padding-bottom: 40px"
          >
            <label for="">Texto más largo</label>

            <textarea
              cols="30"
              rows="3"
              placeholder="Escribe"
              [formControlName]="'description'"
            ></textarea>

            <button
              *ngIf="merchantsService.merchantData"
              (click)="openMetaDescriptionDialog()"
              class="icon-button"
            >
              <img
                [src]="assetsFolder + '/hat-wizard-solid.svg'"
                alt=""
                *ngIf="itemFormData.controls['description'].value"
              />
            </button>
          </div>

          <div class="field-text">
            <label for="">Nombre del botón</label>

            <input
              type="text"
              placeholder="Agregar al carrito"
              [formControlName]="'ctaName'"
            />
          </div>

          <div
            class="added-slides"
            *ngIf="itemSlides.length > 0 && renderQrContent"
          >
            <app-qr-content
              [slides]="itemSlides"
              [showReorderButton]="true"
              [title]="'Slides visuales'"
              [mode]="'SMALL'"
              [editing]="false"
              [defaultText]="'Incluyes fotos, memes, videos o música.'"
              (buttonClicked)="emitFileInputClick()"
              (buttonClicked2)="goToReorderMedia()"
            ></app-qr-content>
          </div>

          <div class="layout-row" *ngIf="itemSlides.length > 0">
            <mat-accordion>
              <mat-expansion-panel
                (opened)="isLayoutDropdownOpened = true"
                (closed)="isLayoutDropdownOpened = false"
                hideToggle
              >
                <mat-expansion-panel-header>
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      justify-content: space-between;
                      width: 100%;
                    "
                  >
                    <span> Layout de los slides predeterminado </span>
                    <mat-icon
                      [ngStyle]="{
                        color: '#7B7B7B',
                        marginLeft: '10px'
                      }"
                      >{{
                        isLayoutDropdownOpened
                          ? "keyboard_arrow_down"
                          : "keyboard_arrow_right"
                      }}
                    </mat-icon>
                  </div>
                </mat-expansion-panel-header>

                <div class="layouts-options">
                  <div
                    class="image-layout-wrapper"
                    (click)="selectLayout('EXPANDED-SLIDE')"
                  >
                    <img
                      class="image-layout"
                      [src]="assetsFolder + '/Expanded-Slide-icon.png'"
                      alt="expanded slide"
                    />
                    <input
                      type="radio"
                      formControlName="defaultLayout"
                      [value]="'EXPANDED-SLIDE'"
                    />
                  </div>
                  <div
                    class="image-layout-wrapper"
                    (click)="selectLayout('ZOOMED-OUT-INFO')"
                  >
                    <img
                      class="image-layout"
                      [src]="assetsFolder + '/minimized-slides.png'"
                      alt="minimized slides"
                    />
                    <input
                      type="radio"
                      formControlName="defaultLayout"
                      [value]="'ZOOMED-OUT-INFO'"
                    />
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>

          <div
            class="field-text"
            *ngIf="
              itemsService.questionsToAddToItem &&
              itemsService.questionsToAddToItem.length > 0
            "
          >
            <h6>Formulario de preguntas</h6>

            <ng-container
              *ngIf="
                requiredQuestionsCounter.required > 0;
                else notRequiredQuestions
              "
            >
              <h4>
                {{
                  requiredQuestionsCounter.required + " preguntas obligatorias"
                }}

                <ng-container *ngIf="requiredQuestionsCounter.notRequired > 0">
                  {{ " y " + requiredQuestionsCounter.notRequired + " mas" }}
                </ng-container>
              </h4>
            </ng-container>

            <ng-template #notRequiredQuestions>
              <h4>
                {{ requiredQuestionsCounter.notRequired + " preguntas" }}
              </h4>
            </ng-template>
          </div>

          <div
            class="field-text hover"
            *ngIf="webform && item"
            (click)="goToWebformCreationOrEdition()"
          >
            <h6>Formulario de preguntas</h6>

            <ng-container
              *ngIf="
                requiredQuestionsCounter.required > 0;
                else notRequiredQuestions
              "
            >
              <h4>
                {{
                  requiredQuestionsCounter.required + " preguntas obligatorias"
                }}

                <ng-container *ngIf="requiredQuestionsCounter.notRequired > 0">
                  {{ " y " + requiredQuestionsCounter.notRequired + " mas" }}
                </ng-container>
              </h4>
            </ng-container>

            <ng-template #notRequiredQuestions>
              <h4>
                {{ requiredQuestionsCounter.notRequired + " preguntas" }}
              </h4>
            </ng-template>
          </div>
        </section>

        <section *ngIf="true">
          <h2 class="section-title">
            OPCIONAL- DATOS QUE LOS COMPRADORES CONSIDERAN IMPORTANTES
          </h2>

          <ng-container *ngIf="!itemFormData.controls['title'].value">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Texto principal y centralizado',
                  iconCallback: openFormForField,
                  fieldNameForCallback: 'TITLE',
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>

          <ng-container *ngIf="!itemFormData.controls['description'].value">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Texto más largo',
                  iconCallback: openFormForField,
                  fieldNameForCallback: 'DESCRIPTION',
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>

          <ng-container *ngIf="!webform && item">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Preguntas a compradores',
                  iconCallback: goToWebformCreationOrEdition,
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>

          <div class="row" *ngIf="!webform && item">
            <span>Preguntas a compradores</span>

            <img
              (click)="goToWebformCreationOrEdition()"
              [src]="assetsFolder + '/add_button_circle.svg'"
              alt="add media"
              class="upload-media"
            />
          </div>
        </section>

        <section *ngIf="true">
          <h2 class="section-title">OPCIONAL- PARA QUE VENDAN POR TI</h2>

          <ng-container
            *ngTemplateOutlet="
              addField;
              context: {
                fieldLabel: 'Cantidad disponible para vender',
                iconCallback: openFormForField,
                fieldNameForCallback: 'STOCK',
                notRequired: true
              }
            "
          >
          </ng-container>
        </section>

        <section
          *ngIf="
            !itemFormData.controls['title'].value ||
            !itemFormData.controls['description'].value ||
            (itemsService.questionsToAddToItem.length === 0 &&
              !webform &&
              !item) ||
            (item && !webform)
          "
        >
          <h2 class="section-title">FUNCIONALIDADES OPCIONALES</h2>

          <ng-container *ngIf="!itemFormData.controls['title'].value">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Texto principal y centralizado',
                  iconCallback: openFormForField,
                  fieldNameForCallback: 'TITLE',
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>

          <ng-container *ngIf="!itemFormData.controls['description'].value">
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Texto más largo',
                  iconCallback: openFormForField,
                  fieldNameForCallback: 'DESCRIPTION',
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>

          <ng-container
            *ngIf="
              itemsService.questionsToAddToItem.length === 0 &&
              !webform &&
              !item
            "
          >
            <ng-container
              *ngTemplateOutlet="
                addField;
                context: {
                  fieldLabel: 'Preguntas a compradores',
                  iconCallback: goToWebformCreationOrEdition,
                  notRequired: true
                }
              "
            >
            </ng-container>
          </ng-container>
        </section>

        <input
          type="file"
          id="file"
          [style.display]="'none'"
          (change)="loadFile($event)"
          multiple
          [accept]="[
            '.png',
            '.jpg',
            '.jpeg',
            '.webp',
            '.webm',
            '.mp4',
            '.m4v',
            '.mpg',
            '.mpeg',
            '.mpeg4',
            '.mov',
            '.3gp',
            '.mts',
            '.m2ts',
            '.mxf'
          ]"
        />

        <!--
        <div class="optional-stuff">
          <h3>FUNCIONALIDADES PARA QUE VENDAN POR TI</h3>
    
          <div class="row">
            <span>Inventario para que se auto-oculte</span>
    
            <img
              (click)="(null)"
              src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/add_button_circle.svg"
              alt="add media"
              class="upload-media"
            />
          </div>
    
          <div class="row">
            <span>¿Qué es?</span>
    
            <img
              (click)="(null)"
              src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/add_button_circle.svg"
              alt="add media"
              class="upload-media"
            />
          </div>
    
          <div class="row">
            <span>% de comisión que pagarás a vendedor..</span>
    
            <img
              (click)="(null)"
              src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/add_button_circle.svg"
              alt="add media"
              class="upload-media"
            />
          </div>
        </div>
      -->
      </ng-container>

      <ng-container *ngSwitchCase="'ITEM_METRICS'">
        <h3 class="metrics-title">Información interna que sólo tu ves:</h3>

        <div class="metric">
          <h4>Cantidad de veces vendido</h4>

          <p>{{ totalSells }} veces, ${{ totalIncome }}</p>
        </div>
      </ng-container>
    </ng-container>
  </main>

  <footer>
    <button
      class="left"
      style="color: #272727"
      (click)="
        !(itemFormData?.valid && itemSlides.length > 0)
          ? goToItemDetail('DEMO')
          : goToItemDetail('PREVIEW')
      "
    >
      {{
        itemFormData?.valid && itemSlides.length > 0
          ? "Preview"
          : "Mira un demo"
      }}
    </button>
    <button
      class="right"
      *ngIf="itemFormData?.valid && itemSlides.length > 0 && !item"
      style="color: #272727"
      (click)="saveItem()"
    >
      Guardar
    </button>

    <button
      class="right"
      *ngIf="
        itemFormData?.valid && itemSlides.length > 0 && isFormUpdated && item
      "
      style="color: #272727"
      (click)="saveItem()"
    >
      Actualizar
    </button>
  </footer>
</div>

<ng-template
  #addField
  let-fieldLabel="fieldLabel"
  let-iconCallback="iconCallback"
  let-fieldNameForCallback="fieldNameForCallback"
  let-notRequired="notRequired"
>
  <div
    class="item-field"
    [ngClass]="{
      empty: !notRequired
    }"
    (click)="
      fieldNameForCallback ? iconCallback(fieldNameForCallback) : iconCallback()
    "
  >
    <div class="field-name">{{ fieldLabel }}</div>

    <img
      class="add-icon"
      [src]="assetsFolder + '/add_button_circle.svg'"
      alt="fill value"
    />
  </div>
</ng-template>
