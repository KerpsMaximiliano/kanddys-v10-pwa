<div class="container">
  <header class="header">
    <button (click)="onBackClick()" class="back-btn">
      <mat-icon class="go_back_arrow" style="font-size: 30px; margin-top: 0.7em;">keyboard_arrow_left</mat-icon>
    </button>
    <!-- <h1 class="method">MÃ©todos de Pagos</h1> -->
  </header>

  <div class="payment-method" *ngIf="status === 'complete'">
    <!--
      <div class="order-amount" *ngIf="order">
        <div class="amount-wrapper">
          <h4 class="title">Subtotal</h4>
          <h3 class="price">${{ paymentAmount | number: "1.2-2" }}</h3>
        </div>
        <div class="amount-wrapper">
          <h4 class="title">A saldar</h4>
          <h3 class="price">${{ paymentAmount | number: "1.2-2" }}</h3>
        </div>
      </div>
    -->

    <div class="amount-list">
      <ng-container>
        <div class="amount-flex-wrapper">
          <h3 class="label">Subtotal a pagar</h3>
          <h2 class="amount">RD $ {{ subtotal | number : "1.2-2" }}</h2>
        </div>
        <div class="amount-flex-wrapper">
          <h3 class="label">Costo de envio</h3>
          <h2 class="amount">RD $ {{ deliveryAmount | number : "1.2-2" }}</h2>
        </div>
        <div class="amount-flex-wrapper" *ngIf="azulPaymentsSupported">
          <h3 class="label">Descuento</h3>
          <h2 class="amount">RD $ 0</h2>
        </div>
        <div class="amount-flex-wrapper" *ngIf="azulPaymentsSupported">
          <h3 class="label">Impuestos</h3>
          <h2 class="amount">RD $ 0</h2>
        </div>
        <div class="amount-flex-wrapper" *ngIf="paymentMethod === 'paypal' && electronicPayments[0]?.feePercentage">
          <h3 class="label">Fee de Paypal</h3>
          <h2 class="amount">RD $ {{ (paymentAmount * electronicPayments[0]?.feePercentage) | number : "1.2-2" }}</h2>
        </div>
      </ng-container>
      <div class="amount-flex-wrapper">
        <h3 class="label highlight">Total a pagar</h3>
        <h2 class="amount highlight">RD $ {{ (paymentMethod === 'paypal' && electronicPayments[0]?.feePercentage ? (paymentAmount * electronicPayments[0]?.feePercentage) + paymentAmount : paymentAmount) | number : "1.2-2" }}</h2>
      </div>

      <br>
      <hr style="margin: 0;">

      <div class="refunds-policies" *ngIf="viewMerchantForRefund">
        <div class="labels">
          <div class="accept-terms">Acepto las polÃ­ticas de reembolso</div>
          <div class="title" (click)="goToRefundPolicies()">
            PolÃ­ticas de reembolsos
          </div>
        </div>

        <div
          class="checkbox"
          [ngClass]="{
            selected: acceptedRefundPolicies
          }"
          (click)="markOrUnmarkCheckbox()"
        ></div>
      </div>
    </div>

    <div class="amount-input" *ngIf="!order">
      <span class="payment-selection"> Monto del depÃ³sito </span>
      <div style="height: 64px">
        <app-currency-input
          (onInputEvent)="depositAmount = $event"
        ></app-currency-input>
      </div>
    </div>
    <span class="payment-selection" *ngIf="!paymentMethod"> Como prefieres pagar?</span>

    <div style="margin-top: 2em;">
      <button mat-button [ngClass]="{ active: paymentMethod === 'bank-transfer' }" class="option-cta" (click)="selectPaymentMethod('bank-transfer')" *ngIf="!paymentMethod && banks.length">
        Transferencia bancaria
      </button>
  
      <button mat-button [ngClass]="{ active: paymentMethod === 'paypal' }" class="option-cta" (click)="selectPaymentMethod('paypal')" *ngIf="!paymentMethod && electronicPayments.length">
        Paypal
      </button>

      <button mat-button [ngClass]="{ active: paymentMethod === 'azul' }" class="option-cta" (click)="selectPaymentMethod('azul')" *ngIf="!paymentMethod && azulPaymentsSupported">
        Tarjeta de crÃ©dito
      </button>
      
      <div
        class="selected-payment flex"
        *ngIf="paymentMethod"
        (click)="selectPaymentMethod(null)"
      >
        <p>MÃ©todo de pago</p>
        <p>
          {{ 
            paymentMethod === 'bank-transfer'
              ? 'Transferencia bancaria'
              : paymentMethod === 'paypal'
              ? 'Paypal'
              : paymentMethod === 'azul'
              ? 'Azul'
              : 'Otro'
          }} >
        </p>
      </div>
    </div>

    <ng-container *ngIf="paymentMethod && paymentMethod !== 'azul'">
      <p class="text-description" *ngIf="paymentMethod === 'bank-transfer'">
        Por favor transfiera en el <span *ngFor="let bank of banks; let i = index">{{ bank.bankName }}, cuenta {{ bank.account }} {{ (banks.length > 1 && i + 1 !== banks.length) ? 'o ' : '' }}</span> y suba aquÃ­ una foto de la pantalla ðŸ‘‡
      </p>
      <p class="text-description" *ngIf="paymentMethod === 'paypal'">
        PayPal te cobra un {{ electronicPayments[0]?.feePercentage | percent:'1.1-2' }} adicional. Por favor haga el pago en <span *ngFor="let electronicPayment of electronicPayments; let i = index">{{ electronicPayment.email }} {{ (electronicPayments.length > 1 && i + 1 !== electronicPayments.length) ? 'o ' : '' }}</span> y suba aquÃ­ una foto de la pantalla ðŸ‘‡
      </p>

      <div 
        mat-button class="file-chooser" 
        (click)="fileChooser.click()" 
        [ngStyle]="{ 
          backgroundImage: 'url(' + imageBase64 + ')',
          padding: imageBase64 ? '70px' : '50px'
        }"
      >
        <mat-icon style="color: #87CD9B; font-size: 45px; font-weight: bold;" *ngIf="!imageBase64">add</mat-icon>
      </div>
    </ng-container>

    <input #fileChooser type="file" [accept]="['.png', '.jpg', '.jpeg', '.webp']" style="display: none;" (change)="fileUpload($event)">

    <p
      class="text-disclaimer"
      style="margin-top: 7em;"
      *ngIf="!paymentMethod && electronicPayments.length"
    >
      PayPal te cobra un 7.5% adicional
    </p>
  </div>

  <div class="footer" [ngClass]="{mobile: !isMobile}">
    <app-sticky-button
      *ngIf="paymentMethod && (order || (!order && depositAmount > 0))"
      (click)="!disableButton && image && submitPayment()"
      [mode]="!disableButton ? 'fixed' : 'disabled-fixed'"
      [text]="
        image
          ? 'Confirmar el pago y facturar'
          : paymentMethod
          ? 'SUBE LA IMAGEN QUE EVIDENCIA EL PAGO'
          : ''
      "
      [size]="'small'"
      [bgColor]="image ? '#87CD9B' : '#A1A1A1'"
      [customLeftButtonStyles]="{
        'letter-space': '1px',
        'font-family': 'RobotoMedium',
        'font-size': '17px',
        color: '#FFFFFF'
      }"
      [color]="image ? '#293628' : '#fff'"
    ></app-sticky-button>
  </div>

  <form [action]="this.azulPaymentURL" method="post" id="azulForm">
    <input type="hidden" id="MerchantID" name="MerchantID" value="...." />
    <input
      type="hidden"
      id="MerchantName"
      name="MerchantName"
      value="D'liciantus"
    />
    <input
      type="hidden"
      id="MerchantType"
      name="MerchantType"
      value="Importadores y productores de flores y follajes"
    />
    <input type="hidden" id="CurrencyCode" name="CurrencyCode" value="$" />
    <input type="hidden" id="OrderNumber" name="OrderNumber" value="2" />
    <input type="hidden" id="Amount" name="Amount" value="9999" />
    <input type="hidden" id="ITBIS" name="ITBIS" value="1800" />
    <input
      type="hidden"
      id="ApprovedUrl"
      name="ApprovedUrl"
      value="http://localhost:5555/success.html"
    />
    <input
      type="hidden"
      id="DeclinedUrl"
      name="DeclinedUrl"
      value="http://localhost:5555/declined.html"
    />
    <input
      type="hidden"
      id="CancelUrl"
      name="CancelUrl"
      value="https://youtube.com"
    />
    <input
      type="hidden"
      id="UseCustomField1"
      name="UseCustomField1"
      value="1"
    />
    <input
      type="hidden"
      id="CustomField1Label"
      name="CustomField1Label"
      value="Custom1"
    />
    <input
      type="hidden"
      id="CustomField1Value"
      name="CustomField1Value"
      value="Value1"
    />
    <input
      type="hidden"
      id="UseCustomField2"
      name="UseCustomField2"
      value="1"
    />
    <input
      type="hidden"
      id="CustomField2Label"
      name="CustomField2Label"
      value="Custom2"
    />
    <input
      type="hidden"
      id="CustomField2Value"
      name="CustomField2Value"
      value="Value2"
    />
    <input type="hidden" id="AuthHash" name="AuthHash" value="......." />
  </form>
</div>

<app-dialog-flow
  [dialogFlowId]="'azulEmailRequest'"
  [status]="openedDialogFlow ? 'OPEN' : 'CLOSE'"
  [dialogs]="dialogs"
  [allowSlideNext]="false"
  (saveConfigRef)="swiperConfig = $event"
  [blockClosure]="true"
></app-dialog-flow>
