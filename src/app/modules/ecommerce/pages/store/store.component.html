<div class="component">
  <header>
    <div class="header" *ngIf="selectedTags.length === 0">
      <div class="title">
        {{
          saleflowData?.merchant?.name.length < 18
            ? "Bienvenido a " + saleflowData?.merchant?.name
            : "Bienvenido a " +
                saleflowData?.merchant?.name.slice(0, 18) +
                ".." || "Tienda"
        }}
      </div>

      <div class="user-area" (click)="openUserManagementDialog()">
        <span *ngIf="user">{{
          (user.name || user.phone || user.email).length > 10
            ? (user.name || user.phone || user.email).slice(0, 10) + ".."
            : user.name || user.phone || user.email
        }}</span>
        <img class="icon" [src]="env + '/user-white.svg'" />
      </div>
    </div>

    <app-helper-headerv3
      *ngIf="selectedTags.length > 0"
      (arrowsClick)="resetSelectedTags()"
      (dotsClicked)="openUserManagementDialog()"
      [showSearch]="selectedTags.length > 0"
      (searchClick)="showSearchbar = true"
    ></app-helper-headerv3>

    <app-tags-selector
      *ngIf="selectedTags.length > 0"
      [tags]="selectedTagsPermanent"
      [selectedTagsIds]="getActiveTagsFromSelectedTagsPermantent()"
      [multipleTags]="true"
      [selectedBackground]="'#ffffff'"
      [background]="'rgb(40, 116, 173)'"
      [selectedColor]="'#2874ad'"
      [color]="'#fff'"
      [fillSelectedTagsOnStart]="true"
      [useIdToRemoveOrAddTags]="true"
      [useAlternativeOutput]="true"
      (tagSelect2)="selectTagFromHeader($event)"
    ></app-tags-selector>

    <div
      *ngIf="selectedTags.length === 0"
      class="blank"
      [ngStyle]="{ paddingBottom: '36px' }"
    ></div>
  </header>
  <main>
    <form class="top-input-area" *ngIf="!hasCustomizer">
      <!-- ********************************************** SEARCHBAR ************************************-->
      <input
        class="text"
        placeholder="Busca por tag o nombre de articulo"
        class="input-top"
        [ngStyle]="{
          marginBottom: tags.length !== 0 ? '28px' : '0px'
        }"
        *ngIf="showSearchbar"
        [formControl]="searchBar"
      />
      <!-- ******************************************** ENDSEARCHBAR ************************************-->

      <!-- ******************************************* TAG SWIPER ***************************************-->
      <div style="width: 100%; padding: 0px 0px 0px 21px">
        <swiper [config]="swiperConfigTag" #tagsSwiper>
          <div
            class="tags-area swiper-slide"
            *ngFor="let tag of unselectedTags"
          >
            <ng-container *ngFor="let tag2 of tags; let tagIndex = index">
              <ng-container *ngIf="tag2._id === tag._id">
                <div
                  (click)="selectTag(tag, tagIndex)"
                  class="tag-item"
                  [ngStyle]="{
                    'background-image':
                      tag.images?.length > 0
                        ? 'url(' + tag.images[0] + ')'
                        : 'url(' + env + '/noimage.png' + ')'
                  }"
                ></div>
                <span class="tag-name">{{ tag.name }}</span>
              </ng-container>
            </ng-container>
          </div>
        </swiper>
      </div>
      <!-- **************************************** END TAG SWIPER ***************************************-->
    </form>

    <!--REGULAR MERCHANT-->
    <div class="content">
      <!--SHOWS ITEMS HIGHLIGHTED-->
      <div
        *ngIf="
          highlightedItems.length > 0 &&
          searchBar.value === '' &&
          selectedTags.length === 0
        "
        [ngStyle]="{
          paddingLeft: '25px'
        }"
      >
        <div class="header-wrapper">
          <h2 class="items-header">Destacados</h2>
        </div>

        <div></div>
        <swiper [config]="swiperConfigHighlightedItems">
          <div
            *ngFor="let item of highlightedItems; let i = index"
            [ngStyle]="{
              width: 'auto',
              paddingBottom: '10px',
              paddingRight: '13px'
            }"
          >
            <app-saleflow-item
              [itemIndex]="i"
              [itemId]="item._id"
              [type]="4"
              [imgURL]="item.images ? item.images[0] : ''"
              [price]="item.pricing"
              [itemParams]="item.params"
              [showPrice]="true"
              (itemClicked)="onItemClick(item._id, true)"
              [dynamicStyles]="{
                itemContainer: {
                  minWidth: '242px',
                  height: '315px',
                  margin: '0px'
                },
                simpleCard: {
                  height: '100%'
                },
                itemImg: {
                  height: '82.8571%'
                },
                infoArea: {
                  height: '17.1429%'
                }
              }"
            ></app-saleflow-item>
            <div class="blank-space"></div>
          </div>
        </swiper>
      </div>

      <div class="title-and-options">
        <h2 class="title">
          {{
            searchBar.value !== ""
              ? "Resultados"
              : searchBar.value === "" && selectedTags.length === 0
              ? "Todos los productos"
              : "Resultados"
          }}
        </h2>
      </div>

      <p class="subtitle" *ngIf="items.length === 0">
        {{
          searchBar.value === "" && items.length === 0
            ? "No hay items"
            : searchBar.value !== "" && items.length === 0
            ? "No se encontr√≥ nada"
            : null
        }}
      </p>

      <div class="saleflows-item-grid">
        <div class="capsize" *ngFor="let item of items; let itemIndex = index">
          <app-saleflow-item
            [itemIndex]="itemIndex"
            [itemId]="item._id"
            [type]="4"
            [inactive]="
              item.status != 'active' && item.status != 'featured'
                ? true
                : false
            "
            [imgURL]="item.images ? item.images[0] : ''"
            [price]="item.pricing"
            [showPrice]="true"
            [itemParams]="item.params"
            (itemClicked)="onItemClick(item._id, true)"
            [responsiveWidthVersion]="true"
          ></app-saleflow-item>
        </div>
      </div>
    </div>
  </main>
</div>
