<div class="container">
  <header
    class="header"
    [ngStyle]="{ backgroundColor: isMerchant ? '#000000' : '#293628' }"
  >
    <button mat-button (click)="!redirectTo ? returnToStore() : returnEvent()">
      <img
        [src]="env + '/arrow-double-up-black.svg'"
        alt=""
        style="
          filter: invert(87%) sepia(6%) saturate(3262%) hue-rotate(67deg)
            brightness(104%) contrast(89%);
        "
      />
    </button>
    <p>WeDoWeLike</p>
    <span>Revistas Virtuales para Monetizar</span>
  </header>

  <a
    class="bar btn notify"
    *ngIf="isMerchant === false"
    [href]="messageLink"
    target="_blank"
  >
    <p>
      Factura creada, envíala por
      <img
        [src]="env + '/whatsapp_black.svg'"
        alt=""
        style="margin: 0px 5px; margin-bottom: -4px"
      />
    </p>
  </a>
  <!-- <ng-container *ngIf="isMerchant && order.orderStatus !== 'draft'">
    <a
      class="benefits-btn"
      [routerLink]="['../../../admin/order-expenses', order._id]"
      queryParamsHandling="merge"
    >
      <p>INGRESOS MENOS EGRESOS</p>
      <span>
        ${{ (benefits ? benefits.benefits - benefits.less : 0) | number }}
      </span>
    </a>
    <div style="padding-top: 4px; margin-bottom: 4px">
      <app-dropdown-menu
        [optionsList]="deliveryStatusOptions"
        [multiple]="false"
        title="STATUS DE LA FACTURA"
        [listTitle]="orderDeliveryStatus(order.orderStatusDelivery)"
        (listValue)="changeOrderStatus($event)"
      ></app-dropdown-menu>
    </div>
    <div>
      <app-dropdown-menu
        logo="/assets/images/noimage.png"
        title="MIS LISTAS DE FACTURAS"
        [listTitle]="
          selectedTagsLength
            ? 'En ' + selectedTagsLength + ' lista(s)'
            : 'Añadela a una lista'
        "
        [optionsList]="tagOptions"
        (listValue)="addTag($event)"
        (panelState)="tagPanelState = $event"
      ></app-dropdown-menu>
    </div>
    <div
      style="background-color: #fff; padding: 0 32px 8px"
      *ngIf="tagPanelState"
    >
      <button mat-button extended (click)="createTag()" class="tag-add">
        <mat-icon>add</mat-icon>
        Crear un nuevo listado
      </button>
    </div>
  </ng-container> -->

  <main class="information">
    <section class="top">
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-wrap: wrap;
        "
      >
        <h2 class="top-h" *ngIf="order">
          FACTURA {{ formatId(order.dateId) }} <br />
          <!-- <button class="top-name btn" *ngIf="isMerchant">
            {{ order?.items[0].saleflow.headline }}
          </button> -->
        </h2>
        <div class="info-display">
          <span class="info" style="margin-left: 0">
            {{ orderDate }}
            <ng-container *ngIf="order?.user">
              para
              <a style="color: #2874ad">
                {{ order.user.name || order.user.phone || order.user.email }}
              </a>
            </ng-container>
          </span>
        </div>
        <!-- <img
          [src]="env + '/qr-code.svg'"
          alt=""
          style="margin-left: auto; cursor: pointer"
        /> -->
      </div>
      <!-- <div class="info-display">
        <span class="info" style="margin-left: 0px">{{
          "Dirección: " +
            order?.items[0].saleflow.module.delivery.pickUpLocations[0].nickName
        }}</span>
      </div> -->
    </section>
    <section class="section">
      <h2
        class="section-title"
        [ngClass]="{
          adminView: isMerchant
        }"
      >
        Artículos facturados:
      </h2>

      <ng-container *ngFor="let item of order?.items; index as i">
        <div class="items-container" style="margin-bottom: 4px">
          <div class="image-container">
            <button class="btn">
              <div
                class="image"
                *ngIf="!urlIsVideo(item.item.images[0].value)"
                (click)="
                  item.item.images?.length &&
                    openImageModal(item.item.images[0].value)
                "
                [ngStyle]="{
                  backgroundImage: item.item.images?.length
                    ? 'url(' + item.item.images[0].value + ')'
                    : '/assets/images/noimage.png',
                  backgroundRepeat: 'no-repeat',
                  backgroundPosition: 'center',
                  backgroundSize: 'cover'
                }"
              ></div>
              <div
                class="video-wrapper videoThumbnail"
                *ngIf="urlIsVideo(item.item.images[0].value)"
                (click)="playVideoOnFullscreen('media' + item._id)"
              >
                <img
                  src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/playIcon.svg"
                  alt="play"
                  class="playVideoIcon"
                  style="padding: 1rem !important; z-index: 99"
                />

                <video
                  [src]="item.item.images[0].value"
                  [id]="'media' + item._id"
                  class="video"
                  [muted]="true"
                ></video>
              </div>
            </button>
            <div class="right" style="width: 100%">
              <div class="top-flex">
                <p class="left-text">
                  {{ item.amount }}x {{ item.item.name || "artículo(s)" }}
                </p>
                <p class="right-text">
                  ${{ order.subtotals[i].amount | number }}
                </p>
              </div>
              <p class="grey">
                {{ item.item.description }}
              </p>
            </div>
            <!-- <div class="question">
              <p class="top-text">Que irá escrito en el globo?</p>
              <p class="bottom-text">RespuestaID</p>
            </div> -->
          </div>
        </div>

        <ng-container *ngIf="answersByItem[item._id]">
          <ng-container
            *ngFor="let question of answersByItem[item._id].response"
          >
            <div *ngIf="question.question" class="webform-question-wrapper">
              <div class="question">
                <p class="top-text">{{ question.question }}</p>
                <p
                  class="bottom-text"
                  *ngIf="!question.isMedia && !question.label"
                >
                  {{ question.value }}
                </p>
                <p
                  class="bottom-text"
                  *ngIf="!question.isMedia && question.label"
                >
                  {{ question.value + " " + question.label }}
                </p>
                <p
                  class="bottom-text"
                  *ngIf="question.isMedia && question.label"
                >
                  {{ question.label }}
                </p>

                <div class="question-img-wrapper" *ngIf="question.isMedia">
                  <div
                    class="image"
                    (click)="openImageModal(question.value)"
                    [ngStyle]="{
                      backgroundRepeat: 'no-repeat',
                      backgroundPosition: 'center',
                      backgroundSize: 'cover',
                      backgroundImage:
                        'url(' +
                        question.value +
                        '), url(https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/spinner2.gif)'
                    }"
                  ></div>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>

      <div
        class="items-container space-between"
        style="padding: 11px 30px 12px 33px; margin-top: 5px"
        *ngIf="payedWithAzul"
      >
        <p class="total">Costo de envio:</p>
        <p class="amount">RD $ {{ 0 | number : "1.2-2" }}</p>
      </div>

      <!-- <div
        class="items-container space-between"
        style="padding: 11px 30px 12px 33px; margin-top: 5px"
      >
        <p class="total">Total facturado:</p>
        <p class="amount" [style]="{ fontSize: '21px' }">
          $ {{ payment | number : "1.2-2" }}
        </p>
      </div> -->
    </section>

    <div
      class="section"
      *ngIf="
        deliveryImages?.deliveryZone ||
        order?.items[0]?.deliveryLocation?.street
      "
    >
      <p class="section-label">ENTREGA</p>
      <div class="questions" *ngIf="deliveryImages?.deliveryZone">
        <p class="label">Zona de entrega</p>
        <p class="label gray-out capitalize">
          {{ deliveryImages?.deliveryZone.zona }}
        </p>
      </div>
      <div class="questions" *ngIf="order.items[0].deliveryLocation">
        <p class="label">Donde entregaremos?</p>
        <p class="label gray-out capitalize">
          {{
            order?.items[0]?.deliveryLocation?.houseNumber
              ? "#" + order?.items[0]?.deliveryLocation?.houseNumber + ", "
              : ""
          }}
          {{ order?.items[0]?.deliveryLocation?.street }},
          {{
            order?.items[0]?.deliveryLocation?.referencePoint
              ? order?.items[0]?.deliveryLocation?.referencePoint + ", "
              : ""
          }}
          {{ order?.items[0]?.deliveryLocation?.city }}, República Dominicana
        </p>
      </div>
      <div class="questions">
        <p class="label">A quien entregaremos?</p>
        <p class="label gray-out capitalize">
          {{ order?.user?.name ? order?.user?.name : order?.user?.phone }}
        </p>
      </div>
      <div class="questions" *ngIf="deliveryImages?.reservation">
        <p class="label">Cuando entregaremos?</p>
        <p class="label gray-out capitalize">
          {{ displayReservation(deliveryImages?.reservation) }}
        </p>
      </div>
    </div>

    <section
      class="section"
      style="margin-top: 50px"
      *ngIf="order?.ocr || payedWithAzul"
    >
      <h2
        class="section-title"
        [ngClass]="{
          adminView: isMerchant
        }"
      >
        Pagos:
      </h2>
      <ng-container *ngIf="payedWithAzul">
        <div class="items-container space-between" style="margin-top: 4px">
          <p class="total">Subtotal a pagar:</p>
          <p class="amount">RD $ {{ payment | number : "1.2-2" }}</p>
        </div>
        <!--       <div class="items-container space-between" style="margin-top: 4px">
          <p class="total">Coins:</p>
          <p class="amount">- {{ payment | number: "1.2-2" }}</p>
        </div> -->
        <div class="items-container space-between" style="margin-top: 4px">
          <p class="total">Descuentos:</p>
          <p class="amount">RD $ {{ 0 | number : "1.2-2" }}</p>
        </div>

        <div class="items-container space-between" style="margin-top: 4px">
          <p class="total">Impuestos:</p>
          <p class="amount">RD $ {{ 0 | number : "1.2-2" }}</p>
        </div>
      </ng-container>

      <!-- <div class="items-container space-between" style="margin-top: 4px">
        <p class="total">MerchantID GiftCard</p>
        <p class="amount">$ {{ payment | number : "1.2-2" }}</p>
      </div> -->
      <div class="items-container space-between" style="margin-top: 4px">
        <p class="total">Total:</p>
        <p class="amount" [style]="{ fontSize: '21px' }">
          $ {{ payment | number : "1.2-2" }}
        </p>
      </div>
      <div class="items-container" style="margin-top: 5px">
        <div class="image-container" style="align-items: center">
          <button
            (click)="order.ocr ? openImageModal(order.ocr.image) : null"
            class="btn"
          >
            <div
              class="image"
              [ngStyle]="{
                'background-image':
                  order.ocr && order.ocr.image
                    ? 'url(' + order.ocr.image + ') '
                    : payedWithAzul
                    ? 'url(https://www.azul.com.do/SiteAssets/v2theme/images/header/AZULLogo.png)'
                    : 'url(/assets/images/noimage.png)'
              }"
            ></div>
          </button>
          <div class="payment-info">
            <span>Pago por {{ paymentType }}</span>
            <div>
              <div
                *ngIf="order.orderStatus === 'to confirm'"
                class="status pending"
              >
                Pago por confirmar
              </div>
              <div
                *ngIf="order.orderStatus === 'completed'"
                class="status confirmed"
              >
                Pago confirmado
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- <div *ngIf="isMerchant" class="info-card">
      <div class="square" [style]="{ background: infoCardBg }"></div>
      <div class="right">
        <p class="bold">Pago por transferencia</p>
        <p class="grey">
          Si necesitamos poner alguno info del pago then iria aqui.
        </p>
      </div>
    </div> -->

    <!-- <section class="section" *ngIf="order?.items[0].deliveryLocation">
      <h2
        class="section-title"
        style="margin-top: 50px"
        [ngClass]="{
          adminView: isMerchant
        }"
      >
        Lugar de
        {{
          order?.items[0].saleflow._id === "62ed5ad9bd70dde4db98b924"
            ? "la sesión"
            : "Entrega:"
        }}
      </h2>
      <div class="items-container column">
        <p
          class="address-name"
          *ngIf="
            (order.items[0].deliveryLocation.nickName &&
              headerService.user?._id === order.user?._id) ||
            (order.items[0].deliveryLocation.nickName &&
              !order.items[0].deliveryLocation.street)
          "
        >
          {{ order.items[0].deliveryLocation.nickName }}
        </p>
        <p
          [ngClass]="{
            added: headerService.user?._id === order.user?._id,
            'address-name': headerService.user?._id !== order.user?._id
          }"
          *ngIf="order.items[0].deliveryLocation.street"
        >
          {{
            order.items[0].deliveryLocation.houseNumber
              ? "#" + order.items[0].deliveryLocation.houseNumber + ", "
              : ""
          }}
          {{ order.items[0].deliveryLocation.street }},
          {{
            order.items[0].deliveryLocation.referencePoint
              ? order.items[0].deliveryLocation.referencePoint + ", "
              : ""
          }}
          {{ order.items[0].deliveryLocation.city }}, República Dominicana
        </p>
      </div>
    </section>
    <section class="section" *ngIf="order?.items[0].reservation && date">
      <h2
        class="section-title"
        style="margin-top: 32px"
        [ngClass]="{
          adminView: isMerchant
        }"
      >
        Fecha de
        {{
          order?.items[0].saleflow._id === "62ed5ad9bd70dde4db98b924"
            ? "la sesión"
            : "Entrega:"
        }}
      </h2>

      <div class="items-container" style="padding: 10px 20px">
        <p class="amount">
          {{ date.weekday }}, {{ date.day }} de {{ date.month }}.
          {{ date.time }}
        </p>
      </div>
    </section> -->
    <!-- <section
      class="section"
      [style]="{ marginTop: '78.5px' }"
    >
      <h2 class="section-title">Entrega:</h2>
      <div class="question">
        <p class="top-text">Donde entregaremos?</p>
        <p class="bottom-text">RespuestaID</p>
      </div>
      <div class="question">
        <p class="top-text">A quien entregaremos?</p>
        <p class="bottom-text">RespuestaID</p>
      </div>
      <div class="question">
        <p class="top-text">Cuando entregaremos?</p>
        <p class="bottom-text">RespuestaID</p>
      </div>
      <button *ngIf="isMerchant" style="margin-top: 25px">
        <p class="blue">Imprime o descarga el QR que enlaza el contenido</p>
      </button>
      <button *ngIf="isMerchant" style="margin-top: 25px">
        <p class="blue">Añadir al TAG de entregado</p>
      </button>
    </section> -->

    <div
      class="section"
      *ngIf="
        post &&
        (post?.message ||
          post?.from ||
          (post?.targets?.length && post.targets[0].name))
      "
    >
      <p class="section-label">MENSAJE DE REGALO (OPCIONAL)</p>

      <div class="questions">
        <p class="label">Escrito en tarjetita física</p>
        <p class="label gray-out">{{ post?.message }}</p>
      </div>

      <div class="questions">
        <p class="label">Nombre del sobre</p>
        <p class="label gray-out">
          {{ post?.targets[0]?.name || post?.title }}
        </p>
      </div>
    </div>

    <!-- VIRTUAL POST SECTION -->
    <!-- <div class="section" *ngIf="entityTemplate && entityTemplateLink">
      <p class="section-label">CONTENIDO VIRTUAL PRIVADO</p>

      <br /><br /><br />

      <div class="flex">
        <div
          class="item-image"
          [ngStyle]="{
            backgroundImage: 'url(' + env + '/qr-code.svg' + ')',
            filter:
              'brightness(0) invert(13%) sepia(9%) saturate(1833%) hue-rotate(68deg) brightness(99%) contrast(83%)'
          }"
        ></div>
        <div class="caption">
          <button class="link-button" (click)="goToPost()">
            Accesa al contenido
          </button>
          <br /><br />
          <button
            class="link-button"
            (click)="copyEntityId(entityTemplate.dateId)"
          >
            Copy el ID
          </button>
          <br /><br />
          <button class="link-button" (click)="downloadQr(qrcodeTemplate)">
            Imprime o descarga el QR
          </button>
        </div>
      </div>
    </div> -->
    <!-- <section
      class="section"
      style="margin-top: 32px"
      *ngIf="
        post?.message ||
        post?.from ||
        (post?.targets?.length && post.targets[0].name)
      "
    >
      <h2
        class="section-title"
        [ngClass]="{
          adminView: isMerchant
        }"
      >
        Mensaje de regalo (opcional)
      </h2>
      <div class="question" *ngIf="post.message">
        <p class="top-text">Escrito en tarjeta fisica</p>
        <p class="bottom-text">{{ post.message }}</p>
      </div>
      <div
        class="question"
        *ngIf="post.targets?.length && post.targets[0]?.name"
      >
        <p class="top-text">Nombre del sobre</p>
        <p class="bottom-text">{{ post.targets[0].name }}</p>
      </div>

      <div class="question" *ngIf="post.title">
        <p class="top-text">Nombre del sobre</p>
        <p class="bottom-text">{{ post.title }}</p>
      </div>

      <div class="question" *ngIf="post.from">
        <p class="top-text">De:</p>
        <p class="bottom-text">{{ post.from }}</p>
      </div>

      <div class="question" *ngIf="post.to">
        <p class="top-text">Para:</p>
        <p class="bottom-text">{{ post.to }}</p>
      </div>

      <div class="question" *ngIf="slides && slides.length">
        <p class="top-text">Contenido del QR:</p>

        <div class="qr-content">
          <div
            class="slide-container"
            *ngFor="let slide of slides; let i; as: index"
          >
            <ng-container *ngIf="slide.type === 'poster' && !slide.isVideo">
              <div
                (click)="openImageModal(slide.media)"
                class="entity-image"
                [ngStyle]="{
                  'background-image': 'url(' + slide.media + ')'
                }"
              ></div>
            </ng-container>

            <ng-container *ngIf="slide.type === 'text'">
              <div class="text-content">
                <div class="content">
                  <p class="subtitle2" *ngIf="slide.text">{{ slide.text }}</p>
                  <p class="title2" *ngIf="slide.title">{{ slide.title }}</p>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="slide.type === 'poster' && slide.isVideo">
              <div
                class="video-wrapper2 videoThumbnail"
                (click)="playVideoOnFullscreen('video' + i)"
              >
                <img
                  src="https://storage-rewardcharly.sfo2.digitaloceanspaces.com/new-assets/playIcon.svg"
                  alt="play"
                  class="playVideoIcon"
                  style="padding: 1rem !important; z-index: 99"
                />

                <video [src]="slide.media" [id]="'video' + i"></video>
              </div>
            </ng-container>
          </div>
        </div>
      </div>

      <ng-container *ngIf="entityTemplate && entityTemplateLink">
        <button class="blue" (click)="downloadQr(qrcodeTemplate)">
          Imprime o descarga el QR que enlaza el contenido
        </button>

        <button class="blue" (click)="copyEntityId(entityTemplate.dateId)">
          Copy en Clipboard el ID del simbolo
          {{ formatId(entityTemplate.dateId) }}
        </button>
      </ng-container>
    </section> -->

    <!-- <section
      class="section"
      *ngIf="
        order?.items[0].post &&
        (post?.message ||
          post?.from ||
          (post?.targets?.length && post?.targets[0].name) ||
          slides?.length)
      "
      style="margin-top: 32px"
    >
      <h2 class="section-title">Mensaje de regalo:</h2>

      <div
        class="buttons-share"
        *ngIf="slides?.length"
        (click)="goToPostDetail()"
      >
        <div class="buttons-area">
          <button class="btn">
            <img [src]="env + '/QR.svg'" width="34px" height="34px" />
          </button>
          <button class="btn">
            <img [src]="env + '/print.svg'" width="34px" height="34px" />
          </button>
          <button class="btn">
            <img
              [src]="env + '/download.svg'"
              width="34px"
              height="34px"
              style="filter: brightness(0)"
            />
          </button>
        </div>
        <h3 class="virtual">Mensaje Virtual</h3>
      </div>

      <div
        class="message-box"
        *ngIf="
          post?.message ||
          post?.from ||
          (post?.targets?.length && post.targets[0].name)
        "
      >
        <section *ngIf="post.message">
          <h3 class="sub">Mensaje a escribir:</h3>
          <p class="message-text inner">
            {{ post.message }}
          </p>
        </section>

        <section *ngIf="post.targets?.length && post.targets[0]?.name">
          <h3 class="sub">Título del sobre:</h3>
          <p class="message-text inner">{{ post.targets[0]?.name }}</p>
        </section>

        <section *ngIf="post.from">
          <h3 class="sub">De:</h3>
          <p class="message-text inner">{{ post.from }}</p>
        </section>
      </div>
    </section> -->
  </main>

  <qrcode
    style="display: none"
    *ngIf="order"
    #qrcode
    [qrdata]="URI + '/ecommerce/order-detail/' + order._id"
    [elementType]="'img'"
    [width]="40"
    [errorCorrectionLevel]="'M'"
    [allowEmptyString]="true"
    colorDark="#000"
  ></qrcode>

  <!-- <footer
    class="footer-display"
    [style.backgroundColor]="
      changeColor ? changeColor : headerService.colorTheme
    "
    *ngIf=""
  >

    <div class="pages-tabs">
      <div class="images-container">
        <img
          [src]="env + image.src"
          *ngFor="let image of imageList"
          class="image"
          (click)="image.callback()"
          [ngStyle]="{
            filter: image.filter && image.filter
          }"
        />
      </div>
    </div>
  </footer> -->

  <!-- Aquí hubo un merge conflict -->

  <!-- <app-sticky-button
  *ngIf="!isMerchant"
  [mode]="'fixed'"
  [bgColor]="'#2874AD'"
  [size]="'small'"
  [fontSize]="'1.25rem'"
  [text]="'VOLVER A LA TIENDA'"
  (click)="goToStore()"
  ></app-sticky-button> -->

  <div style="visibility: hidden; position: absolute; z-index: -99">
    <qrcode
      *ngIf="entityTemplate"
      #qrcodeTemplate
      [qrdata]="entityTemplateLink"
      [elementType]="'img'"
      [width]="500"
      [style.margin-top.px]="-25"
      [errorCorrectionLevel]="'M'"
      [allowEmptyString]="true"
      colorDark="#000000"
    ></qrcode>
  </div>
</div>
