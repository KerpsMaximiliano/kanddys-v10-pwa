<div class="container">
  <header class="header">
    <a class="return-holder" (click)="goBackToFlowRoute()" *ngIf="flowRoute"
      ><i class="fas fa-chevron-left" [style.color]="'white'"></i>
    </a>

    <h1 class="merchant-name">{{ order?.items[0].saleflow.merchant.name }}</h1>

    <div class="right-area">
      <span class="header-text" *ngIf="order">
        {{ order.user?.name || order.user?.phone || order.user?.email }}
      </span>
      <img [src]="env + '/person.svg'" (click)="(redirectToUserContact)" />
    </div>
  </header>

  <div class="bill-area" *ngIf="notify">
    <h2 class="user-name">
      {{ order.user?.name || order.user?.phone || order.user?.email }}
    </h2>
    <h2 class="success">Tu factura se creó exitosamente.</h2>

    <a
      [href]="messageLink"
      target="_blank"
      class="bill-button"
      (click)="notificationClicked()"
    >
      Confirmar por WhatsApp
    </a>

    <p class="bill-clarity">
      Al “confirmar” se abrirá tu WhatsApp con la factura para
      {{ order?.items[0].saleflow.merchant.name }}.
    </p>
  </div>
  <!-- <app-helper-headerv2
    [mode]="'basic'"
    bgColor="#2874AD"
    [returnAble]="false"
    [mainText]="{
      text:
        order?.items[0].saleflow.headline.length < 38
          ? order?.items[0].saleflow.headline
          : order?.items[0].saleflow.headline.split(' ')['0'],
      fontSize: '21px',
      fontFamily: 'SfProBold'
    }"
  ></app-helper-headerv2> -->

  <!-- <div class="box-shadowing">
    <app-item-reservation
      [headline]="{
        text: order ? formatId(order?.dateId) : ''
      }"
      [rightActive]="true"
      [rightSubHeadline]="{
        text: order?.user.name
      }"
      [subheadlines]="[
        {
          text: orderDate
        },
        {
          text: orderStatus
        }
      ]"
      [icon]="[
        {
          src: '/person.svg',
          width: 13,
          height: 17,
          color:
            'invert(35%) sepia(92%) saturate(490%) hue-rotate(164deg) brightness(93%) contrast(84%)',
          callback: redirectToUserContact
        }
      ]"
    ></app-item-reservation>
  </div> -->

  <main class="information">
    <section class="top">
      <h2 class="top-h" *ngIf="order">
        FACTURA {{ formatId(order.dateId) }} EN <br />
        <span class="top-name">{{ order?.items[0].saleflow.headline }}</span>
      </h2>

      <div class="info-display">
        <span class="info" style="margin-left: 0">{{ orderDate }}</span>
        <span class="info">{{ orderStatus | titlecase }}</span>
      </div>
    </section>
    <section class="section">
      <h2 class="section-title">Artículos facturados:</h2>

      <div class="items-container">
        <div
          class="image-container"
          #elemt
          (mousedown)="startDragging($event, elemt)"
          (mouseup)="stopDragging()"
          (mouseleave)="stopDragging()"
          (mousemove)="moveEvent($event, elemt)"
        >
          <button *ngFor="let item of order?.items">
            <ng-container *ngIf="!item.params?.length || customizer">
              <div
                class="image"
                (click)="
                  item.item.images?.length &&
                    openImageModal(item.item.images[0])
                "
                [ngStyle]="{
                  backgroundImage: item.item.images?.length
                    ? 'url(' + item.item.images[0] + ')'
                    : '/assets/images/noimage.png',
                  backgroundRepeat: 'no-repeat',
                  backgroundPosition: 'center',
                  backgroundSize: 'cover'
                }"
              ></div>
            </ng-container>
            <ng-container *ngIf="item.params?.length && !customizer">
              <div *ngFor="let paramValue of item.item.params[0].values">
                <div
                  class="image"
                  *ngIf="
                    item.params[0].param == item.item.params[0]._id &&
                    item.params[0].paramValue == paramValue._id
                  "
                  [ngStyle]="{
                    backgroundImage: paramValue.image
                      ? 'url(' +
                        paramValue.image +
                        '), url(/assets/images/noimage.png)'
                      : '/assets/images/noimage.png',
                    backgroundRepeat: 'no-repeat',
                    backgroundPosition: 'center',
                    backgroundSize: 'cover'
                  }"
                  (click)="openImageModal(paramValue.image)"
                ></div>
              </div>
            </ng-container>
          </button>
        </div>
      </div>
      <div class="items-container" style="margin-top: 5px">
        <div class="items-container space-between" style="padding: 10px 32px">
          <p class="total">Total:</p>
          <p class="amount">RD $ {{ payment | number: "1.2-2" }}</p>
        </div>
      </div>
    </section>

    <section class="section" style="margin-top: 50px">
      <h2 class="section-title">Sobre el pago:</h2>
      <div class="items-container" style="margin-top: 5px" *ngIf="order?.ocr">
        <div
          class="image-container"
          #elemt
          (mousedown)="startDragging($event, elemt)"
          (mouseup)="stopDragging()"
          (mouseleave)="stopDragging()"
          (mousemove)="moveEvent($event, elemt)"
        >
          <button (click)="order.ocr && openImageModal(order.ocr.image)">
            <div
              class="image"
              [ngStyle]="{
                'background-image': order.ocr.image
                  ? 'url(' + order.ocr.image + ') '
                  : 'url(/assets/images/noimage.png)'
              }"
            >
              <!-- <img
                 [src]="
                   order.ocr ? order.ocr.image : '/assets/images/noimage.png'
                 "
                 alt="item image"
                 class="item-image"
               /> -->
            </div>
          </button>
        </div>
      </div>
    </section>

    <section class="section" *ngIf="order?.items[0].deliveryLocation">
      <h2 class="section-title" style="margin-top: 50px">
        Lugar de {{ order?.items[0].reservation ? "la sesión" : " Entrega:" }}
      </h2>

      <div class="items-container column">
        <p
          class="address-name"
          *ngIf="order.items[0].deliveryLocation.nickName"
        >
          {{ order.items[0].deliveryLocation.nickName }}
        </p>
        <p
          [ngClass]="{
            added: order.items[0].deliveryLocation.nickName,
            'address-name': !order.items[0].deliveryLocation.nickName
          }"
          *ngIf="order.items[0].deliveryLocation.street"
        >
          {{
            order.items[0].deliveryLocation.houseNumber
              ? "#" + order.items[0].deliveryLocation.houseNumber + ", "
              : ""
          }}
          {{ order.items[0].deliveryLocation.street }},
          {{
            order.items[0].deliveryLocation.referencePoint
              ? order.items[0].deliveryLocation.referencePoint + ", "
              : ""
          }}
          {{ order.items[0].deliveryLocation.city }}, República Dominicana
        </p>
      </div>
    </section>

    <section class="section" *ngIf="order?.items[0].reservation && date">
      <h2 class="section-title" style="margin-top: 32px">
        Fecha de la sesión:
      </h2>

      <div class="items-container" style="padding: 10px 32px">
        <p class="amount">
          {{ date.weekday }}, {{ date.day }} de {{ date.month }}.
          {{ date.time }}
        </p>
      </div>
    </section>

    <section
      class="section"
      *ngIf="
        (order?.items[0].post && post?.message) ||
        post?.from ||
        post?.targets[0].name
      "
      style="margin-top: 32px"
    >
      <h2 class="section-title">Mensaje de regalo:</h2>

      <div class="message-box">
        <section *ngIf="post.message">
          <h3 class="sub">Mensaje a escribir:</h3>
          <p class="message-text inner">
            {{ post.message }}
          </p>
        </section>

        <section *ngIf="post.targets?.length && post.targets[0]?.name">
          <h3 class="sub">Para:</h3>
          <p class="message-text inner">{{ post.targets[0]?.name }}</p>
        </section>

        <section *ngIf="post.from">
          <h3 class="sub">De:</h3>
          <p class="message-text inner">{{ post.from }}</p>
        </section>
      </div>
    </section>
    <section class="section" *ngIf="customizer" style="margin-top: 32px">
      <h2 class="section-title">Personalización:</h2>
      <div class="items-container" style="flex-direction: column">
        <table>
          <tr *ngFor="let detail of customizerDetails">
            <th>{{ detail.name }}</th>
            <td>{{ detail.value }}</td>
          </tr>
        </table>
        <div *ngIf="customizer.preview">
          <img class="customizer-preview" [src]="customizer.preview" alt="" />
        </div>
      </div>
    </section>
  </main>

  <qrcode
    style="display: none"
    *ngIf="order"
    #qrcode
    [qrdata]="URI + '/ecommerce/order-detail/' + order._id"
    [elementType]="'img'"
    [width]="40"
    [errorCorrectionLevel]="'M'"
    [allowEmptyString]="true"
    colorDark="#000"
  ></qrcode>

  <footer class="footer-display" *ngIf="merchant">
    <!-- TABS INICIO -->
    <div class="pages-tabs">
      <!-- IMAGENES INICIO-->
      <div class="images-container">
        <img
          [src]="env + image.src"
          *ngFor="let image of imageList"
          class="image"
          (click)="image.callback()"
          [ngStyle]="{
            filter: image.filter && image.filter
          }"
        />
      </div>
      <!-- FIN IMAGENES -->
    </div>
    <!-- FIN TABS -->
    <div class="tab-pages"> <!-- TABS INFERIORES -->
      <div class="tab" *ngFor="let tab of tabs"></div>
    </div>
    <!-- FIN TABS INFERIORES -->
  </footer>

  <app-sticky-button
  *ngIf="!merchant"
  [mode]="'fixed'"
  [bgColor]="'#2874AD'"
  [size]="'small'"
  [fontSize]="'1.25rem'"
  [text]="'VOLVER A LA TIENDA'"
  (click)="goToStore()"
></app-sticky-button>

</div>
