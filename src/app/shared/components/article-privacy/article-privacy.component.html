<div class="container">
  <div class="header">
    <div class="icons-container">
      <i
        *ngFor="let icon of icons"
        (click)="goBack()"
        class="fas fa-chevron-{{ icon }}"
      ></i>
    </div>
    <span [style.textAlign]="textAlign" [style.paddingRight]="paddingRight">{{
      text
    }}</span>
  </div>
  <div
    *ngIf="
      options.includes(selected[0]) || selected[0] === 'Solo yo' || !selected[0]
    "
    class="options"
  >
    <p
      *ngFor="let option of options"
      [style.color]="selected.includes(option) ? '#272727' : '#7b7b7b'"
      class="option"
      (click)="handleOption(option)"
    >
      {{ option }}
    </p>
  </div>
  <div
    *ngIf="['invites', 'Yo y mis invitados'].includes(selected[0])"
    class="swiper-container"
  >
    <swiper [config]="swiperConfig">
      <div class="listado" (click)="addTag()">Nueva</div>
      <div
        class="listado"
        *ngFor="let tag of tags"
        [style.color]="
          listadoSelection.includes(tag._id) ? '#272727' : '#7b7b7b'
        "
        (click)="filterRecipients(tag._id)"
      >
        {{ tag.name }}
      </div>
    </swiper>
  </div>
  <ng-container [ngSwitch]="selected">
    <div class="invites-choice" *ngSwitchCase="'Yo y mis invitados'">
      <div class="images-grid">
        <ng-container
          *ngFor="
            let control of controllers.controls.length
              ? controllers.controls
              : [_AbstractControl];
            let j = index
          "
        >
          <div
            id="0{{ j }}"
            attr.aria-label="{{ j + 1 }} / {{ controllers.controls.length }}"
            role="group"
            class="mutimedia-container"
            [style.display]="
              listadoSelection
                ? checkList(control) || j === 0
                  ? 'initial'
                  : 'none'
                : 'initial'
            "
          >
            <div
              [style.background]="multimedia[j][0]"
              [style.filter]="toDelete.includes(j) ? filter : ''"
              class="square {{ j }}"
              (click)="accessContact(j)"
            ></div>
            <button
              (click)="handleController(j)"
              class="plus"
              [style.top]="'10px'"
            >
              <ng-container *ngIf="j === 0; else ex"> + </ng-container>
              <ng-template #ex>
                <ng-container *ngIf="!toDelete.includes(j); else trash"
                  >x</ng-container
                >
                <ng-template #trash
                  ><img [src]="env + '/delete.png'" width="14" height="14"
                /></ng-template>
              </ng-template>
            </button>
            <p *ngIf="j !== 0" class="name-id">
              {{
                control.get("name").value ||
                  control.get("nickname").value ||
                  control.get("email").value ||
                  control.get("phone").value
              }}
            </p>
          </div>
        </ng-container>
      </div>
      <p *ngIf="!toDelete.length" class="paragraph">
        Invitados reciben un link que le permite el acceso por un tiempo
        limitado. La clave no aplica para ellos.
      </p>
      <button *ngIf="toDelete.length" class="submit" (click)="deleteSelected()">
        Eliminar LOS MARCADOS CON
      </button>
      <p
        *ngIf="toDelete.length"
        class="paragraph text-center cursor-pointer mt-5"
        (click)="toDelete = []"
      >
        No eliminar a ningún invitado
      </p>
    </div>
    <div class="invites" *ngSwitchCase="'invites'">
      <ng-container [ngSwitch]="status">
        <div *ngSwitchCase="'loading'" class="loading">Cargando...</div>
        <form *ngSwitchDefault [formGroup]="getFormGroupAt(controlIndex)" class="w-90 mt">
          <div class="input-grid">
            <div>
              <label>Name</label>
              <input
                formControlName="name"
                class="input-base"
                type="text"
                placeholder="Escribe.."
              />
            </div>
            <div>
              <label>Last Name</label>
              <input
                formControlName="lastName"
                class="input-base"
                type="text"
                placeholder="Escribe.."
              />
            </div>
          </div>
          <p class="paragraph">Contact that will receive the access</p>
          <input
            formControlName="email"
            class="input"
            placeholder="Correo Electrónico"
            type="email"
          />
          <input
            formControlName="phone"
            class="input"
            placeholder="WhatsApp.."
            type="tel"
          />
          <p class="paragraph">Photo</p>
          <swiper [config]="swiperConfig">
            <div
              *ngFor="
                let file of controllers.at(controlIndex).get('image')
                  ? controllers.at(controlIndex).get('image').value
                  : [];
                let j = index
              "
              id="0{{ j }}"
              attr.aria-label="{{ j + 1 }} / {{ multimedia[0].length }}"
              role="group"
              class="mutimedia-container"
            >
              <input
                class="hidden"
                type="text"
                type="file"
                [id]="j"
                (change)="loadFile($event, controlIndex, j)"
              />
              <label
                for="{{ j }}"
                [style.background]="multimedia[controlIndex][0]"
                class="square"
              >
                <div class="plus bg-green" [style.top]="'0'">+</div>
              </label>
            </div>
          </swiper>
          <p class="paragraph">Oración identificadora</p>
          <input
            formControlName="nickname"
            class="input"
            placeholder="Escribe.."
            type="text"
          />
          <button
            *ngIf="
              (controllers.at(controlIndex).get('phone').value ||
                controllers.at(controlIndex).get('email').value) &&
              controllers.at(controlIndex).valid
            "
            class="submit"
            type="button"
            (click)="submit()"
          >
            SALVAR COMO INVITADO
          </button>
        </form>
      </ng-container>
    </div>
    <div
      class="password-container"
      *ngSwitchCase="
        'Todos con el link. Tienes la opción de adicionar una clave.. Adicionar'
      "
    >
      <p class="title">
        Escribe la clave que permitirá a los visitantes acceder al contenido:
      </p>
      <input
        [formControl]="password"
        class="input"
        placeholder="Escribe.."
        type="password"
      />
      <p class="paragraph">
        Invitados reciben un link que le permite el acceso por un tiempo
        limitado. La clave no aplica para ellos.
      </p>
    </div>
    <div *ngSwitchDefault class="selection">
      <div
        *ngFor="let item of list; let i = index"
        class="select-option"
        [style.backgroundPosition]="
          selected.includes(item.text) ? 'left bottom' : 'right bottom'
        "
        (click)="item.callback(item.text)"
      >
        <div class="square-item"></div>
        <div>
          <div class="grid-content">
            <img [src]="env + '/' + item.img" width="22" height="22" />
            <span class="text">
              {{
                i === 2
                  ? password.valid
                    ? "Con la clave “" + password.value + "”."
                    : item.text
                  : item.text
              }}
            </span>
          </div>
          <div class="invite-container" *ngIf="item.invites">
            <ng-container
              *ngFor="let control of controllers.controls; let i = index"
            >
              <ng-container *ngIf="control.valid && i > 0">
                <span *ngIf="i === 1" class="invites-text">Invitados</span>
                <div
                  class="invite"
                  [style.left]="'-' + (i + 1) * 4 + 'px'"
                  [style.background]="multimedia[i][0]"
                ></div>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
